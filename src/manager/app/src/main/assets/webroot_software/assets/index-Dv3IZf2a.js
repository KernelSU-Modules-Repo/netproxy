import{n as e,r as t,t as n}from"./mdui-G9ZB-Moc.js";import{a as r,c as i,i as a,l as o,n as s,o as c,r as l,s as u,t as d}from"./vendor-CQiWSFMm.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var f=class{static MODULE_PATH=`/data/adb/modules/netproxy`;static async exec(e,t={}){try{let{errno:n,stdout:r,stderr:i}=await a(e,t);if(n!==0)throw Error(i||`Command failed with code ${n}`);return r.trim()}catch(t){throw console.error(`[KSU.exec]`,e,t),t}}static spawn(e,t=[],n={}){let r=`spawn_callback_`+(Date.now()+`_`+Math.floor(Math.random()*1e3)),i=()=>{let e={};return{listeners:e,on(t,n){e[t]||(e[t]=[]),e[t].push(n)},emit(t,...n){e[t]&&e[t].forEach(e=>{try{e(...n)}catch(e){console.error(`Error in ${r} ${t}`,e)}})}}},a=i(),o=i(),s=i(),c={stdout:{on:(e,t)=>a.on(e,t),emit:a.emit},stderr:{on:(e,t)=>o.on(e,t),emit:o.emit},on:(e,t)=>s.on(e,t),emit:s.emit};window[r]=c,c.on(`exit`,()=>{setTimeout(()=>{delete window[r]},5e3)});try{let i=window.ksu;i&&i.spawn?i.spawn(e,JSON.stringify(t),JSON.stringify(n),r):(console.warn(`[KSU] Native spawn not found, falling back to kernelsu package if possible or failing`),setTimeout(()=>c.emit(`error`,Error(`Native ksu.spawn interface missing`)),0))}catch(e){console.error(`[KSU] Spawn invocation failed`,e),setTimeout(()=>c.emit(`error`,e),0)}return c}static setFullScreen(e){r(e)}static setInsets(e){l(e)}static showToast(e){o(e)}static getModuleInfo(){return i()}static listPackages(e=`user`){return u(e)}static getPackagesInfo(e){return c(e)}static getAppIconUrl(e){return`ksu://icon/${e}`}static async fetchUrl(e){try{return(await this.exec(`curl -sL --connect-timeout 10 --max-time 30 '${e}'`)).trim()||null}catch(t){return console.error(`[KSU.fetchUrl]`,e,t),null}}static spawnAsync(e,t=[],n=5e3){return new Promise(r=>{let i=``,a=!1,o=setTimeout(()=>{a||(a=!0,r({code:-1,stdout:i}))},n);try{let n=this.spawn(e,t);n.stdout.on(`data`,e=>{i+=e}),n.on(`exit`,e=>{a||(a=!0,clearTimeout(o),r({code:e,stdout:i}))}),n.on(`error`,()=>{a||(a=!0,clearTimeout(o),r({code:-1,stdout:i}))})}catch{a||(a=!0,clearTimeout(o),r({code:-1,stdout:``}))}})}},p=class{static async getStatus(){try{return{status:(await f.exec(`pidof -s /data/adb/modules/netproxy/bin/xray 2>/dev/null || echo`)).trim()===``?`stopped`:`running`,config:((await f.exec(`cat ${f.MODULE_PATH}/config/module.conf 2>/dev/null || echo`)).match(/CURRENT_CONFIG="([^"]*)"/)?.[1]||``).split(`/`).pop()||``}}catch{return{status:`unknown`,config:``}}}static async startService(){return f.spawn(`sh`,[`${f.MODULE_PATH}/scripts/core/service.sh`,`start`]),await this.pollServiceStatus(`running`,15e3)}static async stopService(){return f.spawn(`sh`,[`${f.MODULE_PATH}/scripts/core/service.sh`,`stop`]),await this.pollServiceStatus(`stopped`,1e4)}static async pollServiceStatus(e,t){let n=Date.now();for(;Date.now()-n<t;){await new Promise(e=>setTimeout(e,500));try{let{status:t}=await this.getStatus();if(t===e)return!0}catch{}}return!1}static async getUptime(){try{return await f.exec(`
                 pid=$(pidof xray) || exit 1
                 awk 'BEGIN {
                     getline u < "/proc/uptime"; split(u, a, " ")
                     getline s < "/proc/'"$pid"'/stat"; split(s, b, " ")
                     "getconf CLK_TCK" | getline h
                     t = int(a[1] - b[22] / h)
                     d = int(t / 86400); h = int((t % 86400) / 3600); m = int((t % 3600) / 60); s = t % 60
                     if (d > 0) printf "%d-%02d:%02d:%02d", d, h, m, s
                     else printf "%02d:%02d:%02d", h, m, s
                 }'
             `)||`--`}catch{return`--`}}static _lastNetBytes=null;static _lastNetTime=0;static async getNetworkSpeed(){try{let[e,t]=(await f.exec(`awk '/:/ {rx+=$2; tx+=$10} END {print rx, tx}' /proc/net/dev`)).split(/\s+/).map(Number),n=Date.now();if(this._lastNetBytes===null)return this._lastNetBytes={rx:e,tx:t},this._lastNetTime=n,{download:`0 KB/s`,upload:`0 KB/s`};let r=(n-this._lastNetTime)/1e3;if(r<.5)return{download:`0 KB/s`,upload:`0 KB/s`};let i=Math.max(0,Math.floor((e-this._lastNetBytes.rx)/1024/r)),a=Math.max(0,Math.floor((t-this._lastNetBytes.tx)/1024/r));return this._lastNetBytes={rx:e,tx:t},this._lastNetTime=n,{download:`${i} KB/s`,upload:`${a} KB/s`}}catch{return{download:`0 KB/s`,upload:`0 KB/s`}}}static async getTrafficStats(){try{let e=(await f.exec(`awk '/:/ {rx+=$2; tx+=$10} END {print rx, tx}' /proc/net/dev`)).split(/\s+/);return{rx:parseInt(e[0])||0,tx:parseInt(e[1])||0}}catch{return{rx:0,tx:0}}}static _lastSystemCpuTime=null;static _lastProcessCpuTime=null;static _lastProcessId=null;static async getSystemStatus(){try{let e=(await f.exec(`pidof -s /data/adb/modules/netproxy/bin/xray 2>/dev/null || echo`)).trim();if(!e)return{cpu:0,mem:{total:0,used:0,percentage:0}};let t=await f.exec(`grep VmRSS /proc/${e}/status 2>/dev/null`),n=0;if(t){let e=t.match(/VmRSS:\s+(\d+)\s+kB/);e&&(n=parseInt(e[1])*1024)}let r=await f.exec(`grep MemTotal /proc/meminfo 2>/dev/null`),i=0;if(r){let e=r.match(/MemTotal:\s+(\d+)\s+kB/);e&&(i=parseInt(e[1])*1024)}let a=i>0?Math.round(n/i*1e3)/10:0,o=0,s=await f.exec(`cat /proc/${e}/stat 2>/dev/null`),c=await f.exec(`cat /proc/stat | head -n 1`);if(s&&c){let t=s.trim().split(/\s+/),n=c.trim().split(/\s+/);if(t.length>15&&n.length>8){let r=parseInt(t[13])+parseInt(t[14]),i=n.slice(1).reduce((e,t)=>e+(parseInt(t)||0),0);if(this._lastProcessId===e&&this._lastSystemCpuTime!==null&&this._lastProcessCpuTime!==null){let e=r-this._lastProcessCpuTime,t=i-this._lastSystemCpuTime;t>0&&(o=e/t*100,o=Math.min(100,Math.max(0,Math.round(o*10)/10)))}this._lastProcessId=e,this._lastProcessCpuTime=r,this._lastSystemCpuTime=i}}return{cpu:o,mem:{total:i,used:n,percentage:a}}}catch(e){return console.error(`Failed to get Xray status:`,e),{cpu:0,mem:{total:0,used:0,percentage:0}}}}static async getInternalIP(){try{return(await f.exec(`ip -4 addr show 2>/dev/null | awk '/inet / && !/127\\.0\\.0\\.1/ {gsub(/\\/.*/, "", $2); print $2, $NF}' | head -3`)).split(`
`).filter(e=>e.trim()).map(e=>{let t=e.trim().split(/\s+/);return{ip:t[0],iface:t[1]||`unknown`}}).filter(e=>e.ip)}catch{return[]}}static async getExternalIPInfo(){let e=[{url:`https://ipwho.is`,ipField:`ip`,countryField:`country_code`},{url:`https://api.ip.sb/geoip`,ipField:`ip`,countryField:`country_code`},{url:`https://ipapi.co/json`,ipField:`ip`,countryField:`country_code`},{url:`http://ip-api.com/json`,ipField:`query`,countryField:`countryCode`}].map(e=>new Promise((t,n)=>{let r=``,i=!1,a=setTimeout(()=>{i||(i=!0,n(Error(`timeout`)))},5e3);try{let o=f.spawn(`curl`,[`-s`,`--connect-timeout`,`3`,`--max-time`,`5`,e.url]);o.stdout.on(`data`,e=>{r+=e}),o.on(`exit`,o=>{if(!i){if(i=!0,clearTimeout(a),o===0&&r.trim())try{let n=JSON.parse(r.trim()),i=n[e.ipField],a=n[e.countryField];if(i&&typeof i==`string`&&/^[\d.:a-fA-F]+$/.test(i)&&a&&typeof a==`string`&&/^[A-Z]{2}$/.test(a)){t({ip:i,countryCode:a});return}}catch{}n(Error(`failed`))}}),o.on(`error`,()=>{i||(i=!0,clearTimeout(a),n(Error(`error`)))})}catch{i||(i=!0,clearTimeout(a),n(Error(`spawn failed`)))}}));return Promise.any(e).catch(()=>null)}static getPingLatency(e){return new Promise(t=>{let n=``,r=!1,i=setTimeout(()=>{r||(r=!0,t(`timeout`))},3e3);try{let a=f.spawn(`ping`,[`-c`,`1`,`-W`,`2`,e]);a.stdout.on(`data`,e=>{n+=e}),a.on(`exit`,e=>{if(!r){if(r=!0,clearTimeout(i),e===0&&n){let e=n.match(/time=([\d.]+)\s*ms/);if(e){t(`${Math.round(parseFloat(e[1]))} ms`);return}}t(`timeout`)}}),a.on(`error`,()=>{r||(r=!0,clearTimeout(i),t(`failed`))})}catch{r||(r=!0,clearTimeout(i),t(`failed`))}})}static async getOutboundMode(){try{return(await f.exec(`grep '^OUTBOUND_MODE=' ${f.MODULE_PATH}/config/module.conf 2>/dev/null | cut -d'=' -f2`)).trim()||`rule`}catch{return`rule`}}static async setOutboundMode(e){try{let t=``;if(e===`global`){let e=await this.generateGlobalRules();t=`${f.MODULE_PATH}/logs/.mode_rules.json`;let n=btoa(unescape(encodeURIComponent(JSON.stringify(e,null,2))));await f.exec(`echo '${n}' | base64 -d > ${t}`)}else if(e===`direct`){let e=await this.generateDirectRules();t=`${f.MODULE_PATH}/logs/.mode_rules.json`;let n=btoa(unescape(encodeURIComponent(JSON.stringify(e,null,2))));await f.exec(`echo '${n}' | base64 -d > ${t}`)}let n=await f.exec(`sh ${f.MODULE_PATH}/scripts/core/switch-mode.sh ${e} ${t}`);return t&&await f.exec(`rm -f ${t}`).catch(()=>{}),n.includes(`success`)}catch(e){return console.error(`设置出站模式失败:`,e),!1}}static async generateGlobalRules(){return{routing:{domainStrategy:`AsIs`,rules:[{type:`field`,inboundTag:[`tproxy-in`],port:`53`,outboundTag:`dns-out`},{type:`field`,port:`0-65535`,outboundTag:`proxy`},{type:`field`,inboundTag:[`domestic-dns`],outboundTag:`direct`},{type:`field`,inboundTag:[`dns-module`],outboundTag:`proxy`}]}}}static async generateDirectRules(){return{routing:{domainStrategy:`AsIs`,rules:[{type:`field`,inboundTag:[`tproxy-in`],port:`53`,outboundTag:`dns-out`},{type:`field`,port:`0-65535`,outboundTag:`direct`},{type:`field`,inboundTag:[`domestic-dns`],outboundTag:`direct`},{type:`field`,inboundTag:[`dns-module`],outboundTag:`direct`}]}}}},m=class{static async getModuleSettings(){try{let e=await f.exec(`cat ${f.MODULE_PATH}/config/module.conf`),t={},n=e.match(/AUTO_START=(\d+)/);t.auto_start=n?n[1]===`1`:!0;let r=e.match(/ONEPLUS_A16_FIX=(\d+)/);return t.oneplus_a16_fix=r?r[1]===`1`:!0,t}catch{return{auto_start:!0,oneplus_a16_fix:!0}}}static async setModuleSetting(e,t){let n=e.toUpperCase(),r=t?`1`:`0`;return await f.exec(`sed -i 's/${n}=.*/${n}=${r}/' ${f.MODULE_PATH}/config/module.conf`),{success:!0}}static async executeOneplusFix(){return await f.exec(`su -c "sh ${f.MODULE_PATH}/scripts/utils/oneplus_a16_fix.sh"`),{success:!0}}static async openExternalUrl(e){await f.exec(`am start -a android.intent.action.VIEW -d "${e}"`)}static async getProxySettings(){try{let e=await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`),t={};for(let n of[`PROXY_MOBILE`,`PROXY_WIFI`,`PROXY_HOTSPOT`,`PROXY_USB`,`PROXY_TCP`,`PROXY_UDP`,`PROXY_IPV6`]){let r=e.match(RegExp(`${n}=(\\d+)`));t[n.toLowerCase()]=r?r[1]===`1`:!1}return t}catch{return{proxy_mobile:!0,proxy_wifi:!0,proxy_hotspot:!1,proxy_usb:!1,proxy_tcp:!0,proxy_udp:!0,proxy_ipv6:!1}}}static async setProxySetting(e,t){let n=e.toUpperCase(),r=t?`1`:`0`;return await f.exec(`sed -i 's/${n}=.*/${n}=${r}/' ${f.MODULE_PATH}/config/tproxy.conf`),{success:!0}}static async getProxyMode(){try{let e=(await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`)).match(/PROXY_MODE=(\d+)/);return e?parseInt(e[1]):0}catch{return 0}}static async setProxyMode(e){return await f.exec(`sed -i 's/^PROXY_MODE=.*/PROXY_MODE=${e}/' ${f.MODULE_PATH}/config/tproxy.conf`),{success:!0}}static async getDnsConfig(){try{let e=await f.exec(`cat ${f.MODULE_PATH}/config/xray/confdir/02_dns.json`);return JSON.parse(e)}catch(e){return console.error(`获取 DNS 配置失败:`,e),{dns:{hosts:{},servers:[]}}}}static async saveDnsConfig(e){try{let t=JSON.stringify(e,null,4),n=btoa(unescape(encodeURIComponent(t)));return await f.exec(`echo '${n}' | base64 -d > ${f.MODULE_PATH}/config/xray/confdir/02_dns.json`),{success:!0}}catch(e){return console.error(`保存 DNS 配置失败:`,e),{success:!1,error:e.message}}}static async getRoutingRules(){try{let e=await f.exec(`cat ${f.MODULE_PATH}/config/routing_rules.json`);return JSON.parse(e)}catch(e){return console.error(`获取路由规则失败:`,e),[]}}static async saveRoutingRules(e){try{let t=JSON.stringify(e,null,4),n=btoa(unescape(encodeURIComponent(t)));return await f.exec(`echo '${n}' | base64 -d > ${f.MODULE_PATH}/config/routing_rules.json`),{success:!0}}catch(e){return console.error(`保存路由规则失败:`,e),{success:!1,error:e.message}}}static async applyRoutingRules(e){try{let t=[];for(let n of e){if(n.enabled===!1)continue;let e={type:`field`,outboundTag:n.outboundTag||`proxy`};n.domain&&(e.domain=n.domain.split(`,`).map(e=>(e=e.trim(),e.startsWith(`geosite:`)||e.startsWith(`domain:`)||e.startsWith(`full:`)||e.startsWith(`regexp:`)?e:`domain:${e}`))),n.ip&&(e.ip=n.ip.split(`,`).map(e=>e.trim())),n.port&&(e.port=n.port.trim()),n.protocol&&(e.protocol=n.protocol.split(`,`).map(e=>e.trim())),n.network&&(e.network=n.network.trim()),t.push(e)}t.push({type:`field`,inboundTag:[`domestic-dns`],outboundTag:`direct`}),t.push({type:`field`,inboundTag:[`dns-module`],outboundTag:`proxy`});let n={routing:{domainStrategy:`AsIs`,rules:t}},r=JSON.stringify(n,null,4),i=btoa(unescape(encodeURIComponent(r)));return await f.exec(`echo '${i}' | base64 -d > ${f.MODULE_PATH}/config/xray/confdir/03_routing.json`),{success:!0}}catch(e){return console.error(`应用路由规则失败:`,e),{success:!1,error:e.message}}}static async exportLogs(){try{let e=`netproxy_logs_${new Date().toISOString().replace(/[:-]/g,``).replace(`T`,`_`).slice(0,15)}.tar.gz`,t=`/storage/emulated/0/Download`,n=`${t}/${e}`;return await f.exec(`mkdir -p ${t}`),await f.exec(`cd ${f.MODULE_PATH} && tar -czf ${n} logs/`),{success:!0,path:n}}catch(e){return console.error(`导出日志失败:`,e),{success:!1,error:e.message}}}static async exportAll(){try{let e=`netproxy_backup_${new Date().toISOString().replace(/[:-]/g,``).replace(`T`,`_`).slice(0,15)}.tar.gz`,t=`/storage/emulated/0/Download`,n=`${t}/${e}`;return await f.exec(`mkdir -p ${t}`),await f.exec(`cd ${f.MODULE_PATH} && tar -czf ${n} logs/ config/`),{success:!0,path:n}}catch(e){return console.error(`导出日志与配置失败:`,e),{success:!1,error:e.message}}}static async getXrayVersion(){try{let e=(await f.exec(`${f.MODULE_PATH}/bin/xray version`)).match(/Xray\s+([\d.]+)/);return e?e[1]:`unknown`}catch(e){return console.error(`Failed to get Xray version:`,e),`unknown`}}static updateXray(){return new Promise(e=>{let t=``,n=!1,r=setTimeout(()=>{n||(n=!0,e({success:!1,isLatest:!1,message:`更新超时`,error:`操作超时`}))},6e4);try{let i=f.spawn(`sh`,[`${f.MODULE_PATH}/scripts/utils/update-xray.sh`]);i.stdout.on(`data`,e=>t+=e),i.stderr.on(`data`,e=>t+=e),i.on(`exit`,i=>{n||(n=!0,clearTimeout(r),i===0?t.includes(`已是最新版本`)||t.includes(`无需更新`)?e({success:!0,isLatest:!0,message:`已是最新版本，无需更新`,output:t}):t.includes(`更新成功`)||t.includes(`========== 更新成功`)?e({success:!0,isLatest:!1,message:`更新成功`,output:t}):e({success:!0,isLatest:!1,message:`操作完成`,output:t}):e({success:!1,isLatest:!1,message:`更新失败`,error:t}))}),i.on(`error`,t=>{n||(n=!0,clearTimeout(r),e({success:!1,isLatest:!1,message:`更新失败`,error:t.message}))})}catch(t){n||(n=!0,clearTimeout(r),e({success:!1,isLatest:!1,message:`更新失败`,error:t.message}))}})}static async getServiceLog(e=100){try{return await f.exec(`tail -n ${e} ${f.MODULE_PATH}/logs/service.log`)}catch{return`暂无日志`}}static async getXrayLog(e=100){try{return await f.exec(`tail -n ${e} ${f.MODULE_PATH}/logs/xray.log`)}catch{return`暂无日志`}}static async getTproxyLog(e=100){try{return await f.exec(`tail -n ${e} ${f.MODULE_PATH}/logs/tproxy.log`)}catch{return`暂无日志`}}static async renewTProxy(){try{return await f.exec(`sh ${f.MODULE_PATH}/scripts/network/tproxy.sh restart`),{success:!0}}catch(e){return{success:!1,error:e.message}}}static async fetchClashRules(e){return f.fetchUrl(e)}static parseClashPayload(e){let t=[],n=e.split(`
`),r=!1;for(let e of n){let n=e.trim();if(n===`payload:`){r=!0;continue}if(r){if(n&&!n.startsWith(`-`)&&!n.startsWith(`#`))break;if(n.startsWith(`-`)){let e=n.substring(1).trim();e=e.replace(/^['"]|['"]$/g,``),e=e.replace(/^\+\.|^\*\./,``),e&&!e.startsWith(`#`)&&t.push(e)}}}return t}static async importClashRulesFromUrl(e){let t=await this.fetchClashRules(e);return t?this.parseClashPayload(t):[]}},h={"app.name":`NetProxy`,"common.loading":`加载中...`,"common.unknown":`未知`,"common.success":`成功`,"common.failed":`失败`,"common.confirm":`确认`,"common.cancel":`取消`,"common.delete":`删除`,"common.edit":`编辑`,"common.save":`保存`,"common.add":`添加`,"common.edit_mode_enabled":`已进入编辑模式`,"common.layout_saved":`布局已保存`,"dashboard.edit":`编辑仪表盘`,"dashboard.add_widget":`添加组件`,"dashboard.cpu":`CPU 使用率`,"dashboard.memory":`内存使用率`,"dashboard.no_widgets":`暂无可用组件`,"status.uptime":`运行时间`,"status.memory":`内存`,"status.download":`下载`,"status.upload":`上传`,"status.kernel":`内核`,"status.latency_test":`延迟测试`,"status.running_text":`运行中`,"status.stopped_text":`已停止`,"status.normal":`正常`,"status.not_started":`未启动`,"status.start_hint":`点击右下角按钮启动服务`,"status.uptime_failed":`运行时间获取失败`,"status.uptime_prefix":`运行 `,"status.no_config":`无`,"status.network_chart":`网络速度`,"status.internal_ip":`内网IP`,"status.external_ip":`网络检测`,"status.network_detection":`网络检测`,"status.traffic_today":`流量统计`,"status.service_status":`服务状态`,"status.outbound_mode":`出站模式`,"status.mode_rule":`规则`,"status.mode_global":`全局`,"status.mode_direct":`直连`,"status.mode_switched":`模式切换成功`,"status.mode_switch_failed":`模式切换失败`,"config.management":`节点管理`,"config.add_node":`添加节点`,"config.add_outbound":`添加出站`,"nav.status":`状态`,"nav.config":`节点`,"nav.logs":`日志`,"nav.settings":`设置`,"nav.uids":`应用代理`,"status.service_running":`服务运行中`,"status.service_stopped":`服务已停止`,"status.current_config":`当前配置`,"status.start_service":`启动服务`,"status.stop_service":`停止服务`,"status.restart_service":`重启服务`,"status.check_update":`检查更新`,"config.group.default":`默认分组`,"config.node_list":`节点列表`,"config.test_all":`全部测试`,"config.sort_latency":`按延迟排序`,"config.clean_invalid":`清理无效节点`,"config.update_sub":`更新订阅`,"config.delete_sub":`删除订阅`,"config.current":`当前`,"config.test":`测试`,"config.import":`导入配置`,"config.add_sub":`添加订阅`,"config.upload":`上传配置`,"config.clipboard":`从剪贴板导入`,"config.delete_confirm":`确定要删除节点 "{name}" 吗？`,"config.delete_sub_confirm":`确定要删除订阅 "{name}" 吗？
该订阅下的所有节点都将被删除。`,"config.switch_success":`已切换到: {name}`,"logs.service_log":`服务日志`,"logs.title":`日志查看`,"logs.xray_log":`Xray 日志`,"logs.tproxy_log":`TProxy 日志`,"logs.refresh":`刷新日志`,"logs.clean":`清空日志`,"logs.clean_success":`日志已清空`,"logs.auto_refresh":`自动刷新`,"update.checking":`正在检查更新...`,"update.new_version":`发现新版本: {version}`,"update.latest":`当前已是最新版本`,"update.failed":`检查更新失败`,"update.downloading":`正在下载更新...`,"update.installing":`正在安装更新...`,"update.success":`更新成功，正在重启服务...`,"uid.global_proxy":`全局代理`,"uid.global_proxy_desc":`代理所有应用（不推荐）`,"uid.bypass_mode":`绕过模式`,"uid.bypass_mode_desc":`仅代理未选中的应用`,"uid.search_app":`搜索应用...`,"uid.system_apps":`显示系统应用`,"uid.reload_list":`刷新列表`,"settings.theme":`主题设置`,"settings.theme.auto":`跟随系统`,"settings.theme.light":`浅色模式`,"settings.theme.dark":`深色模式`,"settings.about.title":`关于 NetProxy`,"settings.dns.toast_load_failed":`加载 DNS 配置失败`,"settings.language":`语言设置`,"settings.language_desc":`选择应用显示语言`,"settings.routing.empty":`暂无规则，点击右上角添加`,"settings.routing.domain":`域名`,"settings.routing.ip":`IP`,"settings.routing.port":`端口`,"settings.routing.network":`网络`,"settings.routing.protocol":`协议`,"settings.routing.unconditional":`无条件`,"settings.routing.outbound_proxy":`代理`,"settings.routing.outbound_direct":`直连`,"settings.routing.outbound_block":`阻断`,"settings.routing.rule_prefix":`规则 `,"settings.routing.confirm_delete":`确定要删除规则 "{name}" 吗？`,"settings.routing.dialog_add":`添加规则`,"settings.routing.dialog_edit":`编辑规则`,"settings.routing.toast_input_condition":`请至少填写一个匹配条件`,"settings.routing.toast_updated":`规则已更新`,"settings.routing.toast_added":`规则已添加`,"settings.routing.toast_load_failed":`加载路由规则失败`,"settings.dns.empty_server":`暂无 DNS 服务器，点击右上角添加`,"settings.dns.empty_host":`暂无静态 Host，点击右上角添加`,"settings.dns.server_dialog_add":`添加服务器`,"settings.dns.server_dialog_edit":`编辑服务器`,"settings.dns.host_dialog_add":`添加 Host`,"settings.dns.host_dialog_edit":`编辑 Host`,"settings.dns.confirm_delete_server":`确定要删除服务器 "{address}" 吗？`,"settings.dns.confirm_delete_host":`确定要删除 Host "{domain}" 吗？`,"settings.dns.toast_enter_address":`请输入服务器地址`,"settings.dns.toast_enter_domain":`请输入域名`,"settings.dns.toast_enter_ip":`请输入目标 IP`,"settings.dns.toast_server_updated":`服务器已更新`,"settings.dns.toast_server_added":`服务器已添加`,"settings.dns.toast_host_updated":`Host 已更新`,"settings.dns.toast_host_added":`Host 已添加`,"settings.dns.label_tag":`标签`,"settings.dns.toast_save_failed":`保存 DNS 配置失败`,"settings.proxy.mode_auto":`自动`,"settings.proxy.mode_tproxy":`TPROXY`,"settings.proxy.mode_redirect":`REDIRECT`,"settings.proxy.desc_auto":`自动检测最佳代理方式`,"settings.proxy.desc_tproxy":`强制使用 TPROXY 透明代理`,"settings.proxy.desc_redirect":`强制使用 REDIRECT 重定向`,"settings.proxy.toast_mode_set":`代理模式已设为: `,"settings.module.toast_autostart":`开机自启已`,"settings.module.toast_oneplus":`OnePlus A16 兼容性修复已执行`,"settings.module.toast_oneplus_disabled":`OnePlus A16 兼容性修复已禁用`,"settings.theme.toast_mode_switched":`已切换到`,"settings.theme.toast_color_changed":`主题色已更改`,"settings.monet.toast_toggled":`莫奈取色已`,"settings.theme.mode_auto":`自动`,"settings.theme.mode_light":`浅色`,"settings.theme.mode_dark":`深色`,"settings.about.description":`Android 系统级 Xray 透明代理模块`,"settings.about.group":`Telegram 群组`,"settings.about.close":`关闭`,"common.enabled":`启用`,"common.disabled":`禁用`,"common.save_failed":`保存失败: `,"common.set_failed":`设置失败: `,"settings.language.auto":`跟随系统 (Auto)`,"settings.language.zh":`简体中文`,"settings.language.en":`English`,"settings.language.ur":`乌尔都语 (Urdu)`,"settings.about":`关于`,"settings.version":`当前版本`,"settings.author":`作者`,"settings.source":`项目地址`,"settings.docs":`帮助文档`,"settings.tg_channel":`Telegram 频道`,"settings.module":`模块设置`,"settings.proxy":`代理设置`,"settings.routing":`路由规则`,"settings.dns":`DNS 设置`,"settings.logs":`日志`,"common.back_settings":`返回设置`,"uid.app_settings":`分应用设置`,"uid.mode_off":`关闭`,"uid.mode_whitelist":`白名单`,"uid.mode_blacklist":`黑名单`,"uid.exclude_apps":`排除应用`,"logs.save_logs":`保存日志`,"logs.save_all":`保存日志与配置`,"module.title":`模块设置`,"module.desc":`配置模块的基本行为`,"module.autostart":`开机自动启动`,"module.autostart_desc":`开机后自动启动代理服务`,"module.oneplus_fix":`OnePlus A16 兼容性修复`,"routing.title":`路由规则设置`,"routing.desc":`管理 Xray 路由规则`,"routing.import":`导入`,"routing.import_clash":`导入 Clash 规则`,"routing.clash_url":`规则链接`,"routing.clash_url_placeholder":`输入 Clash 规则 YAML 链接`,"routing.clash_name_placeholder":`例如：去广告规则`,"routing.clash_hint":`支持 Clash 域名规则格式 (payload 列表)，自动解析为路由规则`,"routing.toast_url_required":`请输入规则链接`,"routing.toast_importing":`正在导入规则...`,"routing.toast_fetch_failed":`获取规则失败，请检查链接`,"routing.toast_no_domains":`未找到有效的域名规则`,"routing.toast_imported":`导入成功，共 {count} 条规则`,"routing.toast_import_failed":`导入失败: `,"routing.toast_reordered":`规则顺序已更新`,"dns.title":`DNS 设置`,"dns.desc":`管理 DNS 服务器和静态 Hosts 映射`,"dns.servers":`DNS 服务器`,"dns.hosts":`静态 Hosts`,"dns.add_server":`添加服务器`,"dns.add_host":`添加 Host`,"proxy.title":`代理设置`,"proxy.desc":`配置哪些流量需要通过代理`,"proxy.mode":`代理模式`,"proxy.mode_desc":`设置代理模式`,"proxy.mode.auto":`自动`,"proxy.mobile":`移动数据`,"proxy.mobile_desc":`代理移动数据流量`,"config.parser.direct":`直连模式`,"config.parser.unknown":`未知协议`,"config.status.current":`当前`,"config.status.testing":`测试中...`,"config.status.direct":`直连`,"config.status.failed":`失败`,"config.status.timeout":`超时`,"config.menu.test_all":`全部测试`,"config.menu.sort":`按延迟排序`,"config.menu.clean":`清理无效节点`,"config.menu.update_sub":`更新订阅`,"config.menu.delete_sub":`删除订阅`,"config.menu.edit":`编辑`,"config.menu.test":`测试`,"config.menu.delete":`删除`,"config.toast.no_nodes":`没有可测试的节点`,"config.toast.start_test":`开始测试 {count} 个节点...`,"config.toast.test_complete":`测试完成`,"config.toast.sorted":`已重新排序`,"config.toast.need_test":`请先进行测试`,"config.toast.no_invalid":`没有发现无效节点 (需先测试)`,"config.confirm.clean_invalid":`发现 {count} 个无效节点，确定要删除吗？

这属于破坏性操作，无法恢复。`,"config.toast.clean_success":`已清理 {count} 个节点`,"config.confirm.delete_node":`确定要删除节点 "{name}" 吗？

此操作不可恢复。`,"config.toast.deleted":`配置已删除`,"config.toast.delete_failed":`删除失败: `,"config.toast.switch_success":`已切换到: `,"config.toast.switch_failed":`切换配置失败: `,"config.toast.updating_sub":`正在更新订阅...`,"config.toast.sub_updated":`订阅更新成功`,"config.toast.update_failed":`更新失败: `,"config.confirm.delete_sub":`确定要删除订阅 "{name}" 吗？

该订阅下的所有节点都将被删除。`,"config.toast.sub_deleted":`订阅已删除`,"config.toast.enter_sub_name":`请输入订阅名称`,"config.toast.enter_sub_url":`请输入订阅地址`,"config.toast.downloading_sub":`正在下载订阅，请稍候...`,"config.toast.sub_added":`订阅添加成功`,"config.toast.add_failed":`添加失败: `,"config.toast.enter_filename":`请输入文件名`,"config.toast.filename_json":`文件名必须以 .json 结尾`,"config.toast.save_success":`保存成功`,"config.toast.save_failed":`保存失败: `,"config.toast.enter_link":`请输入节点链接`,"config.toast.unsupported_link":`不支持的节点链接格式`,"config.toast.import_success":`节点导入成功`,"config.toast.import_failed":`导入失败: `,"common.confirm_title":`确认操作`,"uid.add_selected_placeholder":`添加选中 (0)`,"settings.routing.outbound_label":`出站标签`,"common.loading_apps":`加载应用列表...`,"settings.theme.mode_title":`外观模式`,"settings.theme.mode_desc":`选择浅色、深色或跟随系统`,"settings.theme.color_title":`主题色`,"settings.theme.color_desc":`选择一个主题色`,"settings.monet.title":`莫奈取色`,"settings.monet.desc":`从系统壁纸提取主题色（仅自动模式可用）`,"status.latency_baidu":`百度`,"status.latency_google":`谷歌`,"status.latency_github":`GitHub`,"config.import_link_title":`节点链接导入`,"config.link_label":`节点链接`,"config.link_placeholder":`支持: vless://, vmess://, trojan://, ss://, socks://, http://, https://`,"config.add_sub_title":`添加订阅`,"config.sub_name_label":`订阅名称`,"config.sub_name_placeholder":`例如: 机场A`,"config.sub_url_label":`订阅地址`,"config.sub_url_placeholder":`https://example.com/sub`,"config.sub_helper":`支持 Base64 编码的订阅链接`,"settings.proxy.mobile":`移动数据`,"settings.proxy.mobile_desc":`代理移动数据流量`,"settings.proxy.wifi":`WiFi`,"settings.proxy.wifi_desc":`代理 WiFi 流量`,"settings.proxy.hotspot":`热点`,"settings.proxy.hotspot_desc":`代理热点连接设备的流量`,"settings.proxy.usb":`USB 共享`,"settings.proxy.usb_desc":`代理 USB 共享设备的流量`,"settings.proxy.tcp":`TCP`,"settings.proxy.tcp_desc":`代理 TCP 流量`,"settings.proxy.udp":`UDP`,"settings.proxy.udp_desc":`代理 UDP 流量`,"settings.proxy.ipv6":`IPv6`,"settings.proxy.ipv6_desc":`启用 IPv6 代理`,"config.dialog_title":`编辑配置`,"config.filename":`文件名`,"config.content":`配置内容`,"uid.dialog_title":`添加 UID`,"uid.input_label":`应用 UID`,"uid.input_helper":`输入应用的 UID 编号`,"uid.select_app_title":`选择应用`,"routing.rule_name":`规则名称`,"routing.domain_helper":`示例: example.com, geosite:cn`,"routing.ip_helper":`示例: 192.168.0.0/16, geoip:cn`,"routing.port_helper":`示例: 443 或 1-1024`,"routing.protocol_helper":`用逗号隔开多个协议`,"routing.network_helper":`tcp 或 udp 或 tcp,udp`,"dns.server_address":`服务器地址`,"dns.server_address_helper":`示例: 8.8.8.8 或 https://dns.google/dns-query`,"dns.domain_match":`域名匹配 (可选)`,"dns.domain_match_helper":`例如: domain:google.com, geosite:cn`,"dns.expect_ip":`期望 IP (可选)`,"dns.expect_ip_helper":`例如: geoip:cn, 223.0.0.0/8`,"dns.skip_fallback":`跳过 Fallback`,"dns.tag":`Tag (可选)`,"dns.host_domain":`域名`,"dns.host_domain_helper":`示例: example.com 或 geosite:category-ads-all`,"dns.host_ip":`目标 IP`,"dns.host_ip_helper":`示例: 127.0.0.1 或 192.168.1.1`,"logs.load_failed":`加载失败`,"logs.saved_to":`日志已保存到: `,"logs.save_failed":`保存日志失败`,"logs.unknown_error":`未知错误`,"logs.saved_all_to":`日志与配置已保存到: `,"logs.debug_cleared":`调试日志已清除`,"uid.title_blacklist":`排除应用`,"uid.title_whitelist":`代理应用`,"uid.empty_blacklist":`暂无排除应用，所有应用都会走代理`,"uid.empty_whitelist":`暂无代理应用，点击上方按钮添加`,"uid.user_label":`用户`,"uid.toast_proxy_disabled":`分应用代理已关闭`,"uid.toast_mode_switched":`已切换为`,"uid.confirm_remove":`确定要移除 {name} 吗？`,"uid.toast_removed":`已移除`,"uid.toast_remove_failed":`移除失败: `,"uid.toast_load_apps_failed":`加载应用列表失败: `,"uid.btn_add_selected":`确认 ({count})`,"uid.toast_added_count":`成功添加 {count} 个应用`,"uid.no_apps_found":`没有找到应用`,"status.service_stopping":`正在停止服务...`,"status.service_stop_timeout":`停止超时，请检查服务状态`,"status.service_starting":`正在启动服务...`,"status.service_started":`服务已启动`,"status.service_start_timeout":`启动超时，请检查服务状态`,"common.operation_failed":`操作失败: `,"common.update_failed":`更新失败: `,"common.check_failed":`检查失败: `,"common.load_failed":`加载失败`},g={"app.name":`NetProxy`,"common.loading":`Loading...`,"common.unknown":`Unknown`,"common.success":`Success`,"common.failed":`Failed`,"common.confirm":`Confirm`,"common.cancel":`Cancel`,"common.delete":`Delete`,"common.edit":`Edit`,"common.save":`Save`,"common.add":`Add`,"common.edit_mode_enabled":`Edit Mode Enabled`,"common.layout_saved":`Layout Saved`,"dashboard.edit":`Edit Dashboard`,"dashboard.add_widget":`Add Widget`,"dashboard.cpu":`CPU Usage`,"dashboard.memory":`Memory Usage`,"dashboard.no_widgets":`No widgets available`,"status.uptime":`Uptime`,"status.memory":`Memory`,"status.download":`Download`,"status.upload":`Upload`,"status.kernel":`Core`,"status.latency_test":`Latency Test`,"status.running_text":`Running`,"status.stopped_text":`Stopped`,"status.normal":`Normal`,"status.not_started":`Not Started`,"status.start_hint":`Click button to start service`,"status.uptime_failed":`Failed to get uptime`,"status.uptime_prefix":`Running `,"status.no_config":`None`,"status.network_chart":`Network Speed`,"status.internal_ip":`Internal IP`,"status.external_ip":`Network Detection`,"status.network_detection":`Network Detection`,"status.traffic_today":`Traffic Usage`,"status.service_status":`Service Status`,"status.outbound_mode":`Outbound Mode`,"status.mode_rule":`Rule`,"status.mode_global":`Global`,"status.mode_direct":`Direct`,"status.mode_switched":`Mode switched successfully`,"status.mode_switch_failed":`Mode switch failed`,"config.management":`Node Management`,"config.add_node":`Add Node`,"config.add_outbound":`Add Outbound`,"nav.status":`Status`,"nav.config":`Config`,"nav.logs":`Logs`,"nav.settings":`Settings`,"nav.uids":`App Proxy`,"status.service_running":`Service Running`,"status.service_stopped":`Service Stopped`,"status.current_config":`Current Config`,"status.start_service":`Start`,"status.stop_service":`Stop`,"status.restart_service":`Restart`,"status.check_update":`Update Check`,"config.group.default":`Default`,"config.node_list":`Nodes`,"config.test_all":`Test All`,"config.sort_latency":`Sort by Latency`,"config.clean_invalid":`Clean Invalid`,"config.update_sub":`Update Sub`,"config.delete_sub":`Delete Sub`,"config.current":`Current`,"config.test":`Test`,"config.import":`Import`,"config.add_sub":`Add Sub`,"config.upload":`Upload`,"config.clipboard":`Clipboard`,"config.delete_confirm":`Delete node "{name}"?`,"config.delete_sub_confirm":`Delete subscription "{name}"?
All nodes in this subscription will be deleted.`,"config.switch_success":`Switched to: {name}`,"logs.service_log":`Service Log`,"logs.title":`Logs`,"logs.xray_log":`Xray Log`,"logs.tproxy_log":`TProxy Log`,"logs.refresh":`Refresh`,"logs.clean":`Clean`,"logs.clean_success":`Logs cleaned`,"logs.auto_refresh":`Auto Refresh`,"update.checking":`Checking for updates...`,"update.new_version":`New version found: {version}`,"update.latest":`Already up to date`,"update.failed":`Update check failed`,"update.downloading":`Downloading update...`,"update.installing":`Installing update...`,"update.success":`Update successful, restarting service...`,"uid.global_proxy":`Global Proxy`,"uid.global_proxy_desc":`Proxy all apps (Not recommended)`,"uid.bypass_mode":`Bypass Mode`,"uid.bypass_mode_desc":`Only proxy unchecked apps`,"uid.search_app":`Search apps...`,"uid.system_apps":`Show System Apps`,"uid.reload_list":`Reload`,"settings.theme":`Theme`,"settings.theme.auto":`Auto`,"settings.theme.light":`Light`,"settings.theme.dark":`Dark`,"settings.about.title":`About NetProxy`,"settings.dns.toast_load_failed":`Failed to load DNS config`,"settings.language":`Language`,"settings.language_desc":`Choose app display language`,"settings.routing.empty":`No rules, click top-right to add`,"settings.routing.domain":`Domain`,"settings.routing.ip":`IP`,"settings.routing.port":`Port`,"settings.routing.network":`Network`,"settings.routing.protocol":`Protocol`,"settings.routing.unconditional":`Unconditional`,"settings.routing.outbound_proxy":`Proxy`,"settings.routing.outbound_direct":`Direct`,"settings.routing.outbound_block":`Block`,"settings.routing.rule_prefix":`Rule `,"settings.routing.confirm_delete":`Are you sure to delete rule "{name}"?`,"settings.routing.dialog_add":`Add Rule`,"settings.routing.dialog_edit":`Edit Rule`,"settings.routing.toast_input_condition":`Please enter at least one condition`,"settings.routing.toast_updated":`Rule updated`,"settings.routing.toast_added":`Rule added`,"settings.routing.toast_load_failed":`Failed to load rules`,"settings.dns.empty_server":`No DNS servers, click top-right to add`,"settings.dns.empty_host":`No static Hosts, click top-right to add`,"settings.dns.server_dialog_add":`Add Server`,"settings.dns.server_dialog_edit":`Edit Server`,"settings.dns.host_dialog_add":`Add Host`,"settings.dns.host_dialog_edit":`Edit Host`,"settings.dns.confirm_delete_server":`Are you sure to delete server "{address}"?`,"settings.dns.confirm_delete_host":`Are you sure to delete Host "{domain}"?`,"settings.dns.toast_enter_address":`Please enter server address`,"settings.dns.toast_enter_domain":`Please enter domain`,"settings.dns.toast_enter_ip":`Please enter IP`,"settings.dns.toast_server_updated":`Server updated`,"settings.dns.toast_server_added":`Server added`,"settings.dns.toast_host_updated":`Host updated`,"settings.dns.toast_host_added":`Host added`,"settings.dns.label_tag":`Tag`,"settings.dns.toast_save_failed":`Failed to save DNS config`,"settings.proxy.mode_auto":`Auto`,"settings.proxy.mode_tproxy":`TPROXY`,"settings.proxy.mode_redirect":`REDIRECT`,"settings.proxy.desc_auto":`Auto detect best mode`,"settings.proxy.desc_tproxy":`Force TPROXY transparent proxy`,"settings.proxy.desc_redirect":`Force REDIRECT`,"settings.proxy.toast_mode_set":`Proxy mode set to: `,"settings.module.toast_autostart":`Auto-start `,"settings.module.toast_oneplus":`OnePlus A16 compatibility fix executed`,"settings.module.toast_oneplus_disabled":`OnePlus A16 compatibility fix disabled`,"settings.theme.toast_mode_switched":`Switched to `,"settings.theme.toast_color_changed":`Theme color changed`,"settings.monet.toast_toggled":`Monet theming `,"settings.theme.mode_auto":`Auto`,"settings.theme.mode_light":`Light`,"settings.theme.mode_dark":`Dark`,"settings.about.description":`Android system-level Xray transparent proxy module`,"settings.about.group":`Telegram Group`,"settings.about.close":`Close`,"common.enabled":`Enabled`,"common.disabled":`Disabled`,"common.save_failed":`Save failed: `,"common.set_failed":`Set failed: `,"settings.language.auto":`Auto`,"settings.language.zh":`简体中文`,"settings.language.en":`English`,"settings.language.ur":`Urdu`,"settings.about":`About`,"settings.version":`Version`,"settings.author":`Author`,"settings.source":`Source`,"settings.docs":`Docs`,"settings.tg_channel":`Telegram Channel`,"settings.module":`Module Settings`,"settings.proxy":`Proxy Settings`,"settings.routing":`Routing Rules`,"settings.dns":`DNS Settings`,"settings.logs":`Logs`,"common.back_settings":`Back to Settings`,"uid.app_settings":`App Settings`,"uid.mode_off":`Off`,"uid.mode_whitelist":`Whitelist`,"uid.mode_blacklist":`Blacklist`,"uid.exclude_apps":`Excluded Apps`,"logs.save_logs":`Save Logs`,"logs.save_all":`Save All`,"module.title":`Module Settings`,"module.desc":`Configure basic module behavior`,"module.autostart":`Auto Start`,"module.autostart_desc":`Start proxy service automatically on boot`,"module.oneplus_fix":`OnePlus A16 Fix`,"routing.title":`Routing Rules`,"routing.desc":`Manage Xray routing rules`,"routing.import":`Import`,"routing.import_clash":`Import Clash Rules`,"routing.clash_url":`Rules URL`,"routing.clash_url_placeholder":`Enter Clash rules YAML URL`,"routing.clash_name_placeholder":`e.g. Ad-Block Rules`,"routing.clash_hint":`Supports Clash domain rules format (payload list), auto-parsed to routing rules`,"routing.toast_url_required":`Please enter the rules URL`,"routing.toast_importing":`Importing rules...`,"routing.toast_fetch_failed":`Failed to fetch rules, check the URL`,"routing.toast_no_domains":`No valid domain rules found`,"routing.toast_imported":`Import successful, {count} rules added`,"routing.toast_import_failed":`Import failed: `,"routing.toast_reordered":`Rule order updated`,"dns.title":`DNS Settings`,"dns.desc":`Manage DNS servers and static hosts`,"dns.servers":`DNS Servers`,"dns.hosts":`Static Hosts`,"dns.add_server":`Add Server`,"dns.add_host":`Add Host`,"proxy.title":`Proxy Settings`,"proxy.desc":`Configure proxied traffic`,"proxy.mode":`Proxy Mode`,"proxy.mode_desc":`Set proxy mode`,"proxy.mode.auto":`Auto`,"proxy.mobile":`Mobile Data`,"proxy.mobile_desc":`Proxy mobile data`,"config.parser.direct":`Direct`,"config.parser.unknown":`Unknown`,"config.status.current":`Current`,"config.status.testing":`Testing...`,"config.status.direct":`Direct`,"config.status.failed":`Failed`,"config.status.timeout":`Timeout`,"config.menu.test_all":`Test All`,"config.menu.sort":`Sort by Latency`,"config.menu.clean":`Clean Invalid`,"config.menu.update_sub":`Update Subscription`,"config.menu.delete_sub":`Delete Subscription`,"config.menu.edit":`Edit`,"config.menu.test":`Test`,"config.menu.delete":`Delete`,"config.toast.no_nodes":`No nodes to test`,"config.toast.start_test":`Testing {count} nodes...`,"config.toast.test_complete":`Test complete`,"config.toast.sorted":`Sorted`,"config.toast.need_test":`Please test first`,"config.toast.no_invalid":`No invalid nodes found (Test first)`,"config.confirm.clean_invalid":`Found {count} invalid nodes. Delete them?

This cannot be undone.`,"config.toast.clean_success":`Cleaned {count} nodes`,"config.confirm.delete_node":`Delete node "{name}"?

This cannot be undone.`,"config.toast.deleted":`Config deleted`,"config.toast.delete_failed":`Delete failed: `,"config.toast.switch_success":`Switched to: `,"config.toast.switch_failed":`Switch failed: `,"config.toast.updating_sub":`Updating subscription...`,"config.toast.sub_updated":`Subscription updated`,"config.toast.update_failed":`Update failed: `,"config.confirm.delete_sub":`Delete subscription "{name}"?

All nodes in it will be deleted.`,"config.toast.sub_deleted":`Subscription deleted`,"config.toast.enter_sub_name":`Enter subscription name`,"config.toast.enter_sub_url":`Enter subscription URL`,"config.toast.downloading_sub":`Downloading, please wait...`,"config.toast.sub_added":`Subscription added`,"config.toast.add_failed":`Add failed: `,"config.toast.enter_filename":`Enter filename`,"config.toast.filename_json":`Filename must end with .json`,"config.toast.save_success":`Saved successfully`,"config.toast.save_failed":`Save failed: `,"config.toast.enter_link":`Enter node link`,"config.toast.unsupported_link":`Unsupported link format`,"config.toast.import_success":`Imported successfully`,"config.toast.import_failed":`Import failed: `,"common.confirm_title":`Confirm Action`,"uid.add_selected_placeholder":`Add Selected (0)`,"settings.routing.outbound_label":`Outbound Tag`,"common.loading_apps":`Loading App List...`,"settings.theme.mode_title":`Appearance`,"settings.theme.mode_desc":`Choose Light, Dark or System`,"settings.theme.color_title":`Theme Color`,"settings.theme.color_desc":`Pick a color`,"settings.monet.title":`Monet Color`,"settings.monet.desc":`Extract from wallpaper (Auto mode only)`,"status.latency_baidu":`Baidu`,"status.latency_google":`Google`,"status.latency_github":`GitHub`,"config.import_link_title":`Import Node Link`,"config.link_label":`Node Link`,"config.link_placeholder":`Support: vless://, vmess://, trojan://, ss://, socks://, http://, https://`,"config.add_sub_title":`Add Subscription`,"config.sub_name_label":`Name`,"config.sub_name_placeholder":`e.g. Provider A`,"config.sub_url_label":`URL`,"config.sub_url_placeholder":`https://example.com/sub`,"config.sub_helper":`Supports Base64 encoded links`,"settings.proxy.mobile":`Mobile Data`,"settings.proxy.mobile_desc":`Proxy mobile data traffic`,"settings.proxy.wifi":`WiFi`,"settings.proxy.wifi_desc":`Proxy WiFi traffic`,"settings.proxy.hotspot":`Hotspot`,"settings.proxy.hotspot_desc":`Proxy hotspot traffic`,"settings.proxy.usb":`USB Tethering`,"settings.proxy.usb_desc":`Proxy USB tethering traffic`,"settings.proxy.tcp":`TCP`,"settings.proxy.tcp_desc":`Proxy TCP traffic`,"settings.proxy.udp":`UDP`,"settings.proxy.udp_desc":`Proxy UDP traffic`,"settings.proxy.ipv6":`IPv6`,"settings.proxy.ipv6_desc":`Enable IPv6 proxy`,"config.dialog_title":`Edit Config`,"config.filename":`Filename`,"config.content":`Content`,"uid.dialog_title":`Add UID`,"uid.input_label":`App UID`,"uid.input_helper":`Enter App UID number`,"uid.select_app_title":`Select App`,"routing.rule_name":`Rule Name`,"routing.domain_helper":`Example: example.com, geosite:cn`,"routing.ip_helper":`Example: 192.168.0.0/16, geoip:cn`,"routing.port_helper":`Example: 443 or 1-1024`,"routing.protocol_helper":`Comma separated protocols`,"routing.network_helper":`tcp or udp or tcp,udp`,"dns.server_address":`Server Address`,"dns.server_address_helper":`Example: 8.8.8.8 or https://dns.google/dns-query`,"dns.domain_match":`Domain Match (Optional)`,"dns.domain_match_helper":`e.g. domain:google.com, geosite:cn`,"dns.expect_ip":`Expected IP (Optional)`,"dns.expect_ip_helper":`e.g. geoip:cn, 223.0.0.0/8`,"dns.skip_fallback":`Skip Fallback`,"dns.tag":`Tag (Optional)`,"dns.host_domain":`Domain`,"dns.host_domain_helper":`Example: example.com or geosite:category-ads-all`,"dns.host_ip":`Target IP`,"dns.host_ip_helper":`Example: 127.0.0.1 or ...`,"logs.load_failed":`Failed to load`,"logs.saved_to":`Logs saved to: `,"logs.save_failed":`Failed to save logs`,"logs.unknown_error":`Unknown error`,"logs.saved_all_to":`Logs and config saved to: `,"logs.debug_cleared":`Debug logs cleared`,"uid.title_blacklist":`Excluded Apps`,"uid.title_whitelist":`Proxy Apps`,"uid.empty_blacklist":`No excluded apps, all apps use proxy`,"uid.empty_whitelist":`No proxy apps, click top to add`,"uid.user_label":`User`,"uid.toast_proxy_disabled":`Per-app proxy disabled`,"uid.toast_mode_switched":`Switched to `,"uid.confirm_remove":`Are you sure to remove {name}?`,"uid.toast_removed":`Removed`,"uid.toast_remove_failed":`Failed to remove: `,"uid.toast_load_apps_failed":`Failed to load app list: `,"uid.btn_add_selected":`Confirm ({count})`,"uid.toast_added_count":`Successfully added {count} apps`,"uid.no_apps_found":`No apps found`,"status.service_stopping":`Stopping service...`,"status.service_stop_timeout":`Stop timeout, please check service status`,"status.service_starting":`Starting service...`,"status.service_started":`Service started`,"status.service_start_timeout":`Start timeout, please check service status`,"common.operation_failed":`Operation failed: `,"common.update_failed":`Update failed: `,"common.check_failed":`Check failed: `,"common.load_failed":`Failed to load`},_={"app.name":`NetProxy`,"common.loading":`لوڈ ہو رہا ہے...`,"common.unknown":`نامعلوم`,"common.success":`کامیاب`,"common.failed":`ناکام`,"common.confirm":`تصدیق کریں`,"common.cancel":`منسوخ کریں`,"common.delete":`حذف کریں`,"common.edit":`ترمیم کریں`,"common.save":`محفوظ کریں`,"common.add":`شامل کریں`,"status.uptime":`وقت چلنے کا دورانیہ`,"status.memory":`میموری`,"status.download":`ڈاؤن لوڈ`,"status.upload":`اپ لوڈ`,"status.kernel":`کرنل`,"status.latency_test":`تاخیر کا ٹیسٹ`,"status.running_text":`چل رہا ہے`,"status.stopped_text":`روکا ہوا`,"status.normal":`نارمل`,"status.not_started":`شروع نہیں ہوا`,"status.start_hint":`سروس شروع کرنے کے لیے بٹن دبائیں`,"status.uptime_failed":`وقت حاصل کرنے میں ناکام`,"status.uptime_prefix":`چل رہا ہے `,"status.no_config":`کوئی نہیں`,"status.network_chart":`نیٹ ورک کی رفتار`,"status.internal_ip":`اندرونی IP`,"status.external_ip":`نیٹ ورک کی جانچ`,"status.traffic_today":`ٹریفک کا استعمال`,"status.service_status":`سروس کی حیثیت`,"config.management":`نوڈ کا انتظام`,"config.add_node":`نوڈ شامل کریں`,"config.add_outbound":`آؤٹ باؤنڈ شامل کریں`,"nav.status":`اسٹیٹس`,"nav.config":`کنفیگ`,"nav.logs":`لاگز`,"nav.settings":`ترتیبات`,"nav.uids":`ایپ پراکسی`,"status.service_running":`سروس چل رہی ہے`,"status.service_stopped":`سروس بند ہے`,"status.current_config":`موجودہ کنفیگریشن`,"status.start_service":`شروع کریں`,"status.stop_service":`روکیں`,"status.restart_service":`دوبارہ شروع کریں`,"status.check_update":`اپ ڈیٹ چیک کریں`,"config.group.default":`ڈیفالٹ`,"config.node_list":`نوڈز`,"config.test_all":`سب ٹیسٹ کریں`,"config.sort_latency":`تاخیر کے لحاظ سے ترتیب دیں`,"config.clean_invalid":`ناکارہ صاف کریں`,"config.update_sub":`سبسکرپشن اپ ڈیٹ کریں`,"config.delete_sub":`سبسکرپشن حذف کریں`,"config.current":`موجودہ`,"config.test":`ٹیسٹ`,"config.import":`درآمد کریں`,"config.add_sub":`سبسکرپشن شامل کریں`,"config.upload":`اپ لوڈ`,"config.clipboard":`کلپ بورڈ`,"config.delete_confirm":`کیا آپ واقعی "{name}" کو حذف کرنا چاہتے ہیں؟`,"config.delete_sub_confirm":`کیا آپ "{name}" سبسکرپشن کو حذف کرنا چاہتے ہیں؟
اس سبسکرپشن کے تمام نوڈز حذف ہو جائیں گے۔`,"config.switch_success":`تبدیل کر دیا گیا: {name}`,"logs.service_log":`سروس لاگ`,"logs.title":`لاگز`,"logs.xray_log":`Xray لاگ`,"logs.tproxy_log":`TProxy لاگ`,"logs.refresh":`تازہ کریں`,"logs.clean":`صاف کریں`,"logs.clean_success":`لاگز صاف ہو گئے`,"logs.auto_refresh":`خودکار تازہ کاری`,"update.checking":`اپ ڈیٹس چیک کی جا رہی ہیں...`,"update.new_version":`نیا ورژن دستیاب ہے: {version}`,"update.latest":`پہلے سے تازہ ترین ہے`,"update.failed":`اپ ڈیٹ چیک ناکام ہو گیا`,"update.downloading":`اپ ڈیٹ ڈاؤن لوڈ ہو رہا ہے...`,"update.installing":`اپ ڈیٹ انسٹال ہو رہا ہے...`,"update.success":`اپ ڈیٹ کامیاب، سروس دوبارہ شروع ہو رہی ہے...`,"uid.global_proxy":`گلوبل پراکسی`,"uid.global_proxy_desc":`تمام ایپس کو پراکسی کریں (تجویز نہیں کی جاتی)`,"uid.bypass_mode":`بائی پاس موڈ`,"uid.bypass_mode_desc":`صرف ان چیک شدہ ایپس کو پراکسی کریں`,"uid.search_app":`ایپس تلاش کریں...`,"uid.system_apps":`سسٹم ایپس دکھائیں`,"uid.reload_list":`دوبارہ لوڈ کریں`,"settings.theme":`تھیم`,"settings.theme.auto":`خودکار`,"settings.theme.light":`لائٹ`,"settings.theme.dark":`ڈارک`,"settings.about.title":`NetProxy کے بارے میں`,"settings.dns.toast_load_failed":`DNS کنفیگ لوڈ کرنے میں ناکام`,"settings.language":`زبان`,"settings.language_desc":`ایپ کی ڈسپلے زبان منتخب کریں`,"settings.routing.empty":`کوئی اصول نہیں، شامل کرنے کے لیے اوپر دائیں کلک کریں`,"settings.routing.domain":`ڈومین`,"settings.routing.ip":`IP`,"settings.routing.port":`پورٹ`,"settings.routing.network":`نیٹ ورک`,"settings.routing.protocol":`پروٹوکول`,"settings.routing.unconditional":`غیر مشروط`,"settings.routing.outbound_proxy":`پراکسی`,"settings.routing.outbound_direct":`ڈائریکٹ`,"settings.routing.outbound_block":`بلاک`,"settings.routing.rule_prefix":`اصول `,"settings.routing.confirm_delete":`کیا آپ "{name}" اصول کو حذف کرنا چاہتے ہیں؟`,"settings.routing.dialog_add":`اصول شامل کریں`,"settings.routing.dialog_edit":`اصول میں ترمیم کریں`,"settings.routing.toast_input_condition":`براہ کرم کم از کم ایک شرط درج کریں`,"settings.routing.toast_updated":`اصول اپ ڈیٹ ہو گیا`,"settings.routing.toast_added":`اصول شامل ہو گیا`,"settings.routing.toast_load_failed":`اصول لوڈ کرنے میں ناکام`,"settings.dns.empty_server":`کوئی DNS سرور نہیں`,"settings.dns.empty_host":`کوئی جامد ہوسٹ نہیں`,"settings.dns.server_dialog_add":`سرور شامل کریں`,"settings.dns.server_dialog_edit":`سرور میں ترمیم کریں`,"settings.dns.host_dialog_add":`Host شامل کریں`,"settings.dns.host_dialog_edit":`Host میں ترمیم کریں`,"settings.dns.confirm_delete_server":`کیا آپ سرور "{address}" کو حذف کرنا چاہتے ہیں؟`,"settings.dns.confirm_delete_host":`کیا آپ Host "{domain}" کو حذف کرنا چاہتے ہیں؟`,"settings.dns.toast_enter_address":`سرور کا پتہ درج کریں`,"settings.dns.toast_enter_domain":`ڈومین درج کریں`,"settings.dns.toast_enter_ip":`IP درج کریں`,"settings.dns.toast_server_updated":`سرور اپ ڈیٹ ہو گیا`,"settings.dns.toast_server_added":`سرور شامل ہو گیا`,"settings.dns.toast_host_updated":`Host اپ ڈیٹ ہو گیا`,"settings.dns.toast_host_added":`Host شامل ہو گیا`,"settings.dns.label_tag":`ٹیگ`,"settings.dns.toast_save_failed":`DNS کنفیگ محفوظ کرنے میں ناکام`,"settings.proxy.mode_auto":`خودکار`,"settings.proxy.mode_tproxy":`TPROXY`,"settings.proxy.mode_redirect":`REDIRECT`,"settings.proxy.desc_auto":`بہترین موڈ کا خودکار پتہ لگائیں`,"settings.proxy.desc_tproxy":`TPROXY شفاف پراکسی کو مجبور کریں`,"settings.proxy.desc_redirect":`REDIRECT کو مجبور کریں`,"settings.proxy.toast_mode_set":`پراکسی موڈ سیٹ کیا گیا: `,"settings.module.toast_autostart":`خودکار اسٹارٹ `,"settings.module.toast_oneplus":`OnePlus A16 اصلاحات لاگو ہو گئیں`,"settings.module.toast_oneplus_disabled":`OnePlus A16 اصلاحات غیر فعال`,"settings.theme.toast_mode_switched":`تبدیل کر دیا گیا: `,"settings.theme.toast_color_changed":`تھیم کا رنگ تبدیل ہو گیا`,"settings.monet.toast_toggled":`Monet تھیمنگ `,"settings.theme.mode_auto":`خودکار`,"settings.theme.mode_light":`لائٹ`,"settings.theme.mode_dark":`ڈارک`,"settings.about.description":`Android سسٹم لیول Xray شفاف پراکسی ماڈیول`,"settings.about.group":`ٹیلی گرام گروپ`,"settings.about.close":`بند کریں`,"common.enabled":`فعال`,"common.disabled":`غیر فعال`,"common.save_failed":`محفوظ کرنے میں ناکام: `,"common.set_failed":`سیٹ کرنے میں ناکام: `,"settings.language.auto":`خودکار`,"settings.language.zh":`چینی (آسان)`,"settings.language.en":`انگریزی`,"settings.language.ur":`اردو`,"settings.about":`کے بارے میں`,"settings.version":`ورژن`,"settings.author":`مصنف`,"settings.source":`سورس`,"settings.docs":`دستاویزات`,"settings.tg_channel":`ٹیلی گرام چینل`,"settings.module":`ماڈیول کی ترتیبات`,"settings.proxy":`پراکسی کی ترتیبات`,"settings.routing":`روٹنگ کے اصول`,"settings.dns":`DNS کی ترتیبات`,"settings.logs":`لاگز`,"common.back_settings":`ترتیبات پر واپس جائیں`,"uid.app_settings":`ایپ کی ترتیبات`,"uid.mode_off":`بند`,"uid.mode_whitelist":`وائٹ لسٹ`,"uid.mode_blacklist":`بلیک لسٹ`,"uid.exclude_apps":`خارج کردہ ایپس`,"logs.save_logs":`لاگز محفوظ کریں`,"logs.save_all":`سب محفوظ کریں`,"module.title":`ماڈیول کی ترتیبات`,"module.desc":`بنیادی ماڈیول رویے کو ترتیب دیں`,"module.autostart":`خودکار اسٹارٹ`,"module.autostart_desc":`بوٹ پر پراکسی سروس خودکار طور پر شروع کریں`,"module.oneplus_fix":`OnePlus A16 اصلاح`,"routing.title":`روٹنگ کے اصول`,"routing.desc":`Xray روٹنگ کے اصولوں کا انتظام کریں`,"dns.title":`DNS کی ترتیبات`,"dns.desc":`DNS سرورز اور جامد ہوسٹس کا انتظام کریں`,"dns.servers":`DNS سرورز`,"dns.hosts":`جامد ہوسٹس`,"dns.add_server":`سرور شامل کریں`,"dns.add_host":`Host شامل کریں`,"proxy.title":`پراکسی کی ترتیبات`,"proxy.desc":`پراکسی ٹریفک کو ترتیب دیں`,"proxy.mode":`پراکسی موڈ`,"proxy.mode_desc":`پراکسی موڈ سیٹ کریں`,"proxy.mode.auto":`خودکار`,"proxy.mobile":`موبائل ڈیٹا`,"proxy.mobile_desc":`موبائل ڈیٹا پراکسی کریں`,"config.parser.direct":`ڈائریکٹ`,"config.parser.unknown":`نامعلوم`,"config.status.current":`موجودہ`,"config.status.testing":`ٹیسٹنگ...`,"config.status.direct":`ڈائریکٹ`,"config.status.failed":`ناکام`,"config.status.timeout":`ٹائم آؤٹ`,"config.menu.test_all":`سب ٹیسٹ کریں`,"config.menu.sort":`تاخیر کے لحاظ سے ترتیب دیں`,"config.menu.clean":`ناکارہ صاف کریں`,"config.menu.update_sub":`سبسکرپشن اپ ڈیٹ کریں`,"config.menu.delete_sub":`سبسکرپشن حذف کریں`,"config.menu.edit":`ترمیم`,"config.menu.test":`ٹیسٹ`,"config.menu.delete":`حذف`,"config.toast.no_nodes":`ٹیسٹ کرنے کے لیے کوئی نوڈز نہیں`,"config.toast.start_test":`{count} نوڈز کا ٹیسٹ شروع ہو رہا ہے...`,"config.toast.test_complete":`ٹیسٹ مکمل`,"config.toast.sorted":`ترتیب دیا گیا`,"config.toast.need_test":`براہ کرم پہلے ٹیسٹ کریں`,"config.toast.no_invalid":`کوئی ناکارہ نوڈز نہیں ملے (پہلے ٹیسٹ کریں)`,"config.confirm.clean_invalid":`{count} ناکارہ نوڈز ملے۔ انہیں حذف کریں؟

یہ عمل واپس نہیں کیا جا سکتا۔`,"config.toast.clean_success":`{count} نوڈز صاف کر دیے گئے`,"config.confirm.delete_node":`کیا آپ "{name}" کو حذف کرنا چاہتے ہیں؟

یہ عمل واپس نہیں کیا جا سکتا۔`,"config.toast.deleted":`کنفیگ حذف ہو گئی`,"config.toast.delete_failed":`حذف کرنے میں ناکام: `,"config.toast.switch_success":`تبدیل کر دیا گیا: `,"config.toast.switch_failed":`تبدیلی ناکام: `,"config.toast.updating_sub":`سبسکرپشن اپ ڈیٹ ہو رہی ہے...`,"config.toast.sub_updated":`سبسکرپشن اپ ڈیٹ ہو گئی`,"config.toast.update_failed":`اپ ڈیٹ ناکام: `,"config.confirm.delete_sub":`کیا آپ "{name}" سبسکرپشن کو حذف کرنا چاہتے ہیں؟

اس کے تمام نوڈز حذف ہو جائیں گے۔`,"config.toast.sub_deleted":`سبسکرپشن حذف ہو گئی`,"config.toast.enter_sub_name":`سبسکرپشن کا نام درج کریں`,"config.toast.enter_sub_url":`سبسکرپشن کا URL درج کریں`,"config.toast.downloading_sub":`ڈاؤن لوڈ ہو رہا ہے، براہ کرم انتظار کریں...`,"config.toast.sub_added":`سبسکرپشن شامل ہو گئی`,"config.toast.add_failed":`شامل کرنے میں ناکام: `,"config.toast.enter_filename":`فائل کا نام درج کریں`,"config.toast.filename_json":`فائل کا نام .json پر ختم ہونا چاہیے`,"config.toast.save_success":`کامیابی سے محفوظ کر لیا گیا`,"config.toast.save_failed":`محفوظ کرنے میں ناکام: `,"config.toast.enter_link":`نوڈ لنک درج کریں`,"config.toast.unsupported_link":`غیر تعاون یافتہ لنک فارمیٹ`,"config.toast.import_success":`درآمد کامیاب`,"config.toast.import_failed":`درآمد ناکام: `,"common.confirm_title":`عمل کی تصدیق کریں`,"uid.add_selected_placeholder":`منتخب شامل کریں (0)`,"settings.routing.outbound_label":`آؤٹ باؤنڈ ٹیگ`,"common.loading_apps":`ایپ لسٹ لوڈ ہو رہی ہے...`,"settings.theme.mode_title":`ظاہری شکل`,"settings.theme.mode_desc":`لائٹ، ڈارک یا سسٹم منتخب کریں`,"settings.theme.color_title":`تھیم کا رنگ`,"settings.theme.color_desc":`ایک رنگ منتخب کریں`,"settings.monet.title":`Monet رنگ`,"settings.monet.desc":`وال پیپر سے نکالیں (صرف خودکار موڈ)`,"status.latency_baidu":`Baidu`,"status.latency_google":`Google`,"status.latency_github":`GitHub`,"config.import_link_title":`نوڈ لنک درآمد کریں`,"config.link_label":`نوڈ لنک`,"config.link_placeholder":`سپورٹ: vless://, vmess://, trojan://, ss://, socks://, http://, https://`,"config.add_sub_title":`سبسکرپشن شامل کریں`,"config.sub_name_label":`نام`,"config.sub_name_placeholder":`مثال: فراہم کنندہ A`,"config.sub_url_label":`URL`,"config.sub_url_placeholder":`https://example.com/sub`,"config.sub_helper":`Base64 انکوڈ شدہ لنکس کو سپورٹ کرتا ہے`,"settings.proxy.mobile":`موبائل ڈیٹا`,"settings.proxy.mobile_desc":`موبائل ڈیٹا ٹریفک پراکسی کریں`,"settings.proxy.wifi":`WiFi`,"settings.proxy.wifi_desc":`WiFi ٹریفک پراکسی کریں`,"settings.proxy.hotspot":`ہاٹ اسپاٹ`,"settings.proxy.hotspot_desc":`ہاٹ اسپاٹ ٹریفک پراکسی کریں`,"settings.proxy.usb":`USB ٹیتھرنگ`,"settings.proxy.usb_desc":`USB ٹیتھرنگ ٹریفک پراکسی کریں`,"settings.proxy.tcp":`TCP`,"settings.proxy.tcp_desc":`TCP ٹریفک پراکسی کریں`,"settings.proxy.udp":`UDP`,"settings.proxy.udp_desc":`UDP ٹریفک پراکسی کریں`,"settings.proxy.ipv6":`IPv6`,"settings.proxy.ipv6_desc":`IPv6 پراکسی کو فعال کریں`,"config.dialog_title":`کنفیگ میں ترمیم کریں`,"config.filename":`فائل کا نام`,"config.content":`مواد`,"uid.dialog_title":`UID شامل کریں`,"uid.input_label":`ایپ UID`,"uid.input_helper":`ایپ UID نمبر درج کریں`,"uid.select_app_title":`ایپ منتخب کریں`,"routing.rule_name":`اصول کا نام`,"routing.domain_helper":`مثال: example.com, geosite:cn`,"routing.ip_helper":`مثال: 192.168.0.0/16, geoip:cn`,"routing.port_helper":`مثال: 443 یا 1-1024`,"routing.protocol_helper":`کوما سے الگ کردہ پروٹوکول`,"routing.network_helper":`tcp یا udp یا tcp,udp`,"dns.server_address":`سرور کا پتہ`,"dns.server_address_helper":`مثال: 8.8.8.8 یا https://dns.google/dns-query`,"dns.domain_match":`ڈومین میچ (اختیاری)`,"dns.domain_match_helper":`مثال: domain:google.com, geosite:cn`,"dns.expect_ip":`متوقع IP (اختیاری)`,"dns.expect_ip_helper":`مثال: geoip:cn, 223.0.0.0/8`,"dns.skip_fallback":`فال بیک چھوڑیں`,"dns.tag":`ٹیگ (اختیاری)`,"dns.host_domain":`ڈومین`,"dns.host_domain_helper":`مثال: example.com`,"dns.host_ip":`ہدف IP`,"dns.host_ip_helper":`مثال: 127.0.0.1`,"logs.load_failed":`لوڈ کرنے میں ناکام`,"logs.saved_to":`لاگز یہاں محفوظ ہو گئے: `,"logs.save_failed":`لاگز محفوظ کرنے میں ناکام`,"logs.unknown_error":`نامعلوم غلطی`,"logs.saved_all_to":`لاگز اور کنفیگ یہاں محفوظ ہو گئے: `,"logs.debug_cleared":`ڈیبگ لاگز صاف ہو گئے`,"uid.title_blacklist":`خارج کردہ ایپس`,"uid.title_whitelist":`پراکسی ایپس`,"uid.empty_blacklist":`کوئی خارج کردہ ایپس نہیں، تمام ایپس پراکسی استعمال کرتی ہیں`,"uid.empty_whitelist":`کوئی پراکسی ایپس نہیں، شامل کرنے کے لیے اوپر کلک کریں`,"uid.user_label":`صارف`,"uid.toast_proxy_disabled":`فی ایپ پراکسی غیر فعال ہے`,"uid.toast_mode_switched":`تبدیل کر دیا گیا: `,"uid.confirm_remove":`کیا آپ "{name}" کو ہٹانا چاہتے ہیں؟`,"uid.toast_removed":`ہٹا دیا گیا`,"uid.toast_remove_failed":`ہٹانے میں ناکام: `,"uid.toast_load_apps_failed":`ایپ لسٹ لوڈ کرنے میں ناکام: `,"uid.btn_add_selected":`تصدیق کریں ({count})`,"uid.toast_added_count":`{count} ایپس کامیابی سے شامل ہو گئیں`,"uid.no_apps_found":`کوئی ایپس نہیں ملیں`,"status.service_stopping":`سروس رک رہی ہے...`,"status.service_stop_timeout":`رکنے کا ٹائم آؤٹ، براہ کرم اسٹیٹس چیک کریں`,"status.service_starting":`سروس شروع ہو رہی ہے...`,"status.service_started":`سروس شروع ہو گئی`,"status.service_start_timeout":`شروع ہونے کا ٹائم آؤٹ، براہ کرم اسٹیٹس چیک کریں`,"common.operation_failed":`آپریشن ناکام: `,"common.update_failed":`اپ ڈیٹ ناکام: `,"common.check_failed":`چیک ناکام: `,"common.load_failed":`لوڈ کرنے میں ناکام`},v=class{static STORAGE_KEY=`language`;static DEFAULT_LANG=`zh-CN`;static currentLang=`zh-CN`;static resources={"zh-CN":h,"en-US":g,"ur-PK":_};static init(){let e=localStorage.getItem(this.STORAGE_KEY);e&&this.resources[e]?this.currentLang=e:navigator.language.startsWith(`en`)?this.currentLang=`en-US`:this.currentLang=`zh-CN`,document.documentElement.lang=this.currentLang,this.applyLanguage()}static setLanguage(e){e===`auto`?(localStorage.removeItem(this.STORAGE_KEY),this.init()):this.resources[e]&&(this.currentLang=e,localStorage.setItem(this.STORAGE_KEY,e),document.documentElement.lang=e,this.applyLanguage())}static getLanguage(){return localStorage.getItem(this.STORAGE_KEY)||`auto`}static t(e,t={}){let n=(this.resources[this.currentLang]||this.resources[this.DEFAULT_LANG])[e]||e;for(let[e,r]of Object.entries(t))n=n.replace(RegExp(`\\{${e}\\}`,`g`),String(r));return n}static applyLanguage(){this.currentLang===`ur-PK`?document.documentElement.dir=`rtl`:document.documentElement.dir=`ltr`,document.querySelectorAll([`[data-i18n]`,`[data-i18n-placeholder]`,`[data-i18n-label]`,`[data-i18n-headline]`,`[data-i18n-helper]`,`[data-i18n-description]`].join(`,`)).forEach(e=>{let t=e.getAttribute(`data-i18n`);t&&(e.textContent=this.t(t)),[`placeholder`,`label`,`headline`,`helper`,`description`].forEach(t=>{let n=e.getAttribute(`data-i18n-${t}`);n&&e.setAttribute(t,this.t(n))})}),window.dispatchEvent(new CustomEvent(`language-changed`,{detail:{lang:this.currentLang}}))}};function y(e,t=!1){n({message:e,closeable:t,autoCloseDelay:t?0:3e3,placement:`bottom`})}var b=e=>{let t=e.toUpperCase();if(t.length!==2)return e;let n=t.codePointAt(0)-65+127462,r=t.codePointAt(1)-65+127462;return String.fromCodePoint(n)+String.fromCodePoint(r)},x=(e,t)=>{let n=e.replace(`#`,``);return n.length===8?`rgba(${parseInt(n.substring(0,2),16)}, ${parseInt(n.substring(2,4),16)}, ${parseInt(n.substring(4,6),16)}, ${(parseInt(t,16)/255).toFixed(2)})`:`#`+n+t},S=class{ui;uptimeStartTime;uptimeInterval;speedChart;speedHistory;maxDataPoints;trafficStats;sortable;isEditing;constructor(e){this.ui=e,this.uptimeStartTime=null,this.uptimeInterval=null,this.speedChart=null,this.speedHistory={time:[],download:[],upload:[]},this.maxDataPoints=10,this.trafficStats={rx:0,tx:0},this.sortable=null,this.isEditing=!1,this.loadLayout(),this.bindEvents()}toggleEditMode(){this.isEditing=!this.isEditing;let e=document.getElementById(`dashboard-grid`),t=document.getElementById(`edit-dashboard-btn`),n=document.getElementById(`add-widget-panel`);e&&(this.isEditing?(e.classList.add(`editing-mode`),t&&t.classList.add(`active`),n&&(n.classList.add(`visible`),this.renderAddWidgetList()),this.sortable=new s(e,{animation:200,ghostClass:`sortable-ghost`,dragClass:`sortable-drag`,delay:200,delayOnTouchOnly:!0,filter:`.card-delete-btn`,onEnd:()=>{this.saveLayout()}})):(e.classList.remove(`editing-mode`),t&&t.classList.remove(`active`),n&&n.classList.remove(`visible`),this.sortable&&=(this.sortable.destroy(),null),this.saveLayout()))}saveLayout(){let e=document.getElementById(`dashboard-grid`);if(!e)return;let t=Array.from(e.children).filter(e=>e.style.display!==`none`).map(e=>e.id).filter(e=>e);localStorage.setItem(`dashboard-layout`,JSON.stringify(t))}loadLayout(){let e=localStorage.getItem(`dashboard-layout`),t=document.getElementById(`dashboard-grid`);if(!t)return;let n=Array.from(t.children);if(e)try{let r=JSON.parse(e),i=document.createDocumentFragment();r.forEach(e=>{let t=n.find(t=>t.id===e);t&&(t.style.display=``,i.appendChild(t))}),n.forEach(e=>{r.includes(e.id)||(e.style.display=`none`,i.appendChild(e))}),t.appendChild(i)}catch(e){console.error(`Failed to load dashboard layout`,e)}}bindEvents(){let e=document.getElementById(`dashboard-grid`);e&&e.addEventListener(`click`,e=>{let t=e.target.closest(`.card-delete-btn`);if(t&&this.isEditing){let n=t.closest(`.common-card`);n&&n.id&&(this.removeCard(n.id),e.stopPropagation())}});let t=document.getElementById(`close-add-widget-btn`);t&&t.addEventListener(`click`,()=>{this.toggleEditMode()})}removeCard(e){let t=document.getElementById(e);t&&(t.style.display=`none`,this.saveLayout(),this.renderAddWidgetList())}addCard(e){let t=document.getElementById(e),n=document.getElementById(`dashboard-grid`);t&&n&&(t.style.display=``,n.appendChild(t),this.saveLayout(),this.renderAddWidgetList())}renderAddWidgetList(){let e=document.getElementById(`add-widget-list`),t=document.getElementById(`dashboard-grid`);if(!e||!t)return;e.innerHTML=``;let n=Array.from(t.children).filter(e=>e.style.display===`none`);if(n.length===0){e.innerHTML=`<div style="color: var(--monet-on-surface-variant); font-size: 14px; padding: 8px;">无可用组件</div>`;return}n.forEach(t=>{let n=t.querySelector(`.card-title`),r=t.querySelector(`.card-icon`),i=n?n.textContent:t.id,a=r?r.getAttribute(`name`):`widgets`,o=document.createElement(`div`);o.className=`widget-preview-item`,o.innerHTML=`
                <mdui-icon name="${a}"></mdui-icon>
                <span>${i}</span>
                <mdui-icon name="add" style="font-size: 16px; margin-left: 4px;"></mdui-icon>
            `,o.onclick=()=>{this.addCard(t.id)},e.appendChild(o)})}async update(){try{let{status:e}=await p.getStatus(),t=document.getElementById(`service-fab`),n=document.getElementById(`dashboard-fab`);if(e===`running`){if(t&&(t.icon=`stop`),n&&n.classList.add(`running`),!this.uptimeInterval){let e=await p.getUptime();e&&e!==`--`&&e!==`N/A`&&!e.includes(`failed`)&&this.startUptimeTimer(e)}}else{t&&(t.icon=`play_arrow`),n&&n.classList.remove(`running`);let e=document.getElementById(`fab-runtime`);e&&(e.textContent=``),this.stopUptimeTimer()}this.speedChart||this.initSpeedChart(),await this.updateNetworkSpeed(),await this.updateIPAndTraffic(),await this.updateModeUI();let r=await p.getSystemStatus(),i=document.getElementById(`cpu-usage`);i&&(i.textContent=`${r.cpu}%`);let a=document.getElementById(`memory-usage`);a&&(a.textContent=`${r.mem.percentage}%`)}catch(e){console.error(`Update status failed:`,e)}}async updateNetworkSpeed(){try{let e=await p.getNetworkSpeed(),t=parseFloat(e.download.replace(` KB/s`,``).trim())||0,n=parseFloat(e.upload.replace(` KB/s`,``).trim())||0,r=document.getElementById(`header-speed-text`);if(r){let e=e=>e>=1024?`${(e/1024).toFixed(1)} MB/s`:e>=1?`${e.toFixed(0)} KB/s`:`${(e*1024).toFixed(0)} B/s`;r.textContent=`↑ ${e(n)}   ↓ ${e(t)}`}let i=0;this.speedHistory.time.length>0&&(i=this.speedHistory.time[this.speedHistory.time.length-1]+1),this.speedHistory.time.push(i),this.speedHistory.download.push(t),this.speedHistory.upload.push(n),this.speedHistory.time.length>this.maxDataPoints&&(this.speedHistory.time.shift(),this.speedHistory.download.shift(),this.speedHistory.upload.shift()),this.speedChart&&this.speedChart.setData([this.speedHistory.time,this.speedHistory.download,this.speedHistory.upload])}catch(e){console.error(`Update network speed failed:`,e)}}async updateIPAndTraffic(){try{let e=await p.getInternalIP(),t=document.getElementById(`internal-ip`);t&&(e&&e.length>0?(t.textContent=e[0].ip,t.title=e.map(e=>`${e.ip} (${e.iface})`).join(`
`)):t.textContent=v.t(`status.no_network`)||`无网络`)}catch{let e=document.getElementById(`internal-ip`);e&&(e.textContent=`--`)}this.updateExternalIP();try{let e=await p.getTrafficStats();this.trafficStats=e;let t=document.getElementById(`traffic-upload`),n=document.getElementById(`traffic-download`);if(t&&n){let{value:r,unit:i}=this.formatTraffic(e.tx),{value:a,unit:o}=this.formatTraffic(e.rx);t.textContent=r,t.nextElementSibling&&(t.nextElementSibling.textContent=i),n.textContent=a,n.nextElementSibling&&(n.nextElementSibling.textContent=o)}this.updateDonutChart(e.tx,e.rx)}catch{let e=document.getElementById(`traffic-upload`),t=document.getElementById(`traffic-download`);e&&(e.textContent=`0`),t&&(t.textContent=`0`)}}formatTraffic(e){return e>=1024*1024*1024?{value:(e/1024/1024/1024).toFixed(2),unit:`GB`}:e>=1024*1024?{value:(e/1024/1024).toFixed(1),unit:`MB`}:e>=1024?{value:(e/1024).toFixed(0),unit:`KB`}:{value:e.toString(),unit:`B`}}updateExternalIP(){let e=document.getElementById(`external-ip`),t=document.getElementById(`network-detection-icon`);e&&(e.innerHTML=`<span class="loading-spinner"></span>`),p.getExternalIPInfo().then(n=>{if(t)if(n){let e=b(n.countryCode);t instanceof HTMLElement&&t.tagName.toLowerCase()===`span`?(t.className=`flag-icon twemoji`,t.textContent=e):t.outerHTML=`<span id="network-detection-icon" class="flag-icon twemoji">${e}</span>`}else t.outerHTML=`<mdui-icon name="network_check" class="card-icon" id="network-detection-icon"></mdui-icon>`;e&&(e.textContent=n?.ip||`--`)}).catch(()=>{t&&(t.outerHTML=`<mdui-icon name="network_check" class="card-icon" id="network-detection-icon"></mdui-icon>`),e&&(e.textContent=`--`)})}updateDonutChart(e,t){let n=document.getElementById(`traffic-donut`);if(!n)return;let r=e+t;if(r===0){n.innerHTML=`
                <svg viewBox="0 0 100 100" class="active">
                    <circle cx="50" cy="50" r="35" fill="none" stroke="var(--mdui-color-outline-variant, #ccc)" stroke-width="10"/>
                </svg>
            `;return}let i=e/r,a=2*Math.PI*35,o=i*a,s=(1-i)*a;n.innerHTML=`
            <svg viewBox="0 0 100 100" class="active">
                <circle cx="50" cy="50" r="35" fill="none" 
                    stroke="var(--monet-secondary, #2196F3)" stroke-width="10"
                    stroke-dasharray="${s} ${a}"
                    transform="rotate(-90 50 50)"/>
                <circle cx="50" cy="50" r="35" fill="none" 
                    stroke="var(--monet-primary, #4CAF50)" stroke-width="10"
                    stroke-dasharray="${o} ${a}"
                    stroke-dashoffset="${-s}"
                    transform="rotate(-90 50 50)"/>
            </svg>
        `}initSpeedChart(){let e=document.getElementById(`speed-chart-container`);if(!e||e.clientWidth===0){setTimeout(()=>this.initSpeedChart(),100);return}document.documentElement.classList.contains(`mdui-theme-dark`)||document.documentElement.classList.contains(`mdui-theme-auto`)&&window.matchMedia(`(prefers-color-scheme: dark)`).matches;let t=getComputedStyle(document.documentElement).getPropertyValue(`--monet-primary`).trim()||`#4CAF50`,n=getComputedStyle(document.documentElement).getPropertyValue(`--monet-secondary`).trim()||`#2196F3`;this.speedHistory.time=[0,1],this.speedHistory.download=[0,0],this.speedHistory.upload=[0,0],this.speedChart=new d({width:e.clientWidth,height:e.clientHeight||80,series:[{},{label:`Download`,stroke:n,width:2,paths:d.paths.spline(),points:{show:!1},fillTo:-1e9,fill:(e,t)=>{let r=e.ctx.createLinearGradient(0,0,0,e.height);return r.addColorStop(0,x(n,`60`)),r.addColorStop(1,x(n,`1A`)),r}},{label:`Upload`,stroke:t,width:2,paths:d.paths.spline(),points:{show:!1},fillTo:-1e9,fill:(e,n)=>{let r=e.ctx.createLinearGradient(0,0,0,e.height);return r.addColorStop(0,x(t,`60`)),r.addColorStop(1,x(t,`1A`)),r}}],axes:[{show:!1},{show:!1}],scales:{x:{time:!1},y:{auto:!0,range:(e,t,n)=>{let r=Math.max(n,100);return[-r*.45,r]}}},legend:{show:!1},cursor:{show:!1},padding:[0,0,0,0]},[this.speedHistory.time,this.speedHistory.download,this.speedHistory.upload],e),window.addEventListener(`resize`,()=>{this.speedChart&&e&&e.clientWidth>0&&this.speedChart.setSize({width:e.clientWidth,height:e.clientHeight||80})}),this.refreshLatency()}startUptimeTimer(e){let t=e.split(/[-:]/),n=0;t.length===4?n=parseInt(t[0])*86400+parseInt(t[1])*3600+parseInt(t[2])*60+parseInt(t[3]):t.length===3?n=parseInt(t[0])*3600+parseInt(t[1])*60+parseInt(t[2]):t.length===2&&(n=parseInt(t[0])*60+parseInt(t[1])),this.uptimeStartTime=Date.now()-n*1e3,this.uptimeInterval&&clearInterval(this.uptimeInterval),this.updateUptimeDisplay(),this.uptimeInterval=setInterval(()=>this.updateUptimeDisplay(),1e3)}stopUptimeTimer(){this.uptimeInterval&&=(clearInterval(this.uptimeInterval),null),this.uptimeStartTime=null}updateUptimeDisplay(){if(!this.uptimeStartTime)return;let e=Math.floor((Date.now()-this.uptimeStartTime)/1e3),t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60,i=`${String(t).padStart(2,`0`)}:${String(n).padStart(2,`0`)}:${String(r).padStart(2,`0`)}`,a=document.getElementById(`fab-runtime`);a&&(a.textContent=i+`\xA0\xA0`)}async updateModeUI(){try{let e=await p.getOutboundMode();document.querySelectorAll(`.mode-option`).forEach(t=>{t.dataset.mode===e?t.classList.add(`active`):t.classList.remove(`active`)});let t=document.getElementById(`nav-config`);t&&(t.style.display=e===`direct`?`none`:``)}catch(e){console.error(`更新模式 UI 失败:`,e)}}setupModeButtons(){let e=document.querySelectorAll(`.mode-option`);e.forEach(t=>{t.addEventListener(`click`,async()=>{let n=t.dataset.mode;if(t.classList.contains(`active`)||t.classList.contains(`loading`))return;t.classList.add(`loading`);let r=document.getElementById(`nav-config`);r&&(r.style.display=n===`direct`?`none`:``);let i=document.querySelector(`.mode-option.active`);e.forEach(e=>e.classList.remove(`active`)),t.classList.add(`active`);try{await p.setOutboundMode(n)||(e.forEach(e=>e.classList.remove(`active`)),i&&i.classList.add(`active`),r&&(r.style.display=i?.dataset.mode===`direct`?`none`:``),y(v.t(`status.mode_switch_failed`)||`模式切换失败`))}catch(e){console.error(`模式切换失败:`,e),y(e.message||`模式切换失败`)}finally{t.classList.remove(`loading`)}})})}async refreshLatency(){try{let e=document.getElementById(`refresh-latency-btn`);e&&(e.loading=!0,e.disabled=!0);let t=document.getElementById(`latency-value`);t&&(t.textContent=`...`),await new Promise(e=>setTimeout(e,500));let n=await p.getPingLatency(`google.com`);if(t)if(n===`timeout`||n===`failed`)t.textContent=`N/A`,t.style.color=`var(--mdui-color-error)`;else{t.textContent=n;let e=parseInt(n);e<100?t.style.color=`var(--mdui-color-success)`:e<200?t.style.color=`var(--mdui-color-warning)`:t.style.color=`var(--mdui-color-error)`}}catch{let e=document.getElementById(`latency-value`);e&&(e.textContent=`Error`)}finally{let e=document.getElementById(`refresh-latency-btn`);e&&(e.loading=!1,e.disabled=!1)}}updateSpeedChartColors(){this.speedChart&&(this.speedChart.destroy(),this.speedChart=null,this.initSpeedChart())}},C=class{static async getConfigGroups(){let e=[],t=`${f.MODULE_PATH}/config/xray/outbounds`;try{let n=(await f.exec(`find ${t} -maxdepth 1 -name '*.json' -exec basename {} \\;`)).split(`
`).filter(e=>e);n.length>0&&e.push({type:`default`,name:`默认分组`,dirName:``,configs:n})}catch{}let n=await this.getSubscriptions();for(let r of n)try{let n=await f.exec(`find ${t}/${r.dirName} -name '*.json' ! -name '_meta.json' -exec basename {} \\;`);e.push({type:`subscription`,name:r.name,dirName:r.dirName,url:r.url,updated:r.updated,configs:n.split(`
`).filter(e=>e)})}catch{}return e}static async readConfig(e){return await f.exec(`cat '${f.MODULE_PATH}/config/xray/outbounds/${e}'`)}static async batchReadConfigInfos(e){if(!e||e.length===0)return new Map;let t=`${f.MODULE_PATH}/config/xray/outbounds`,n=e.map(e=>`${t}/${e}`).join(`
`),r=await f.exec(`
            while IFS= read -r f; do
                [ -z "$f" ] && continue
                echo "===FILE:$(basename "$f")==="
                head -30 "$f" 2>/dev/null | grep -E '"protocol"|"address"|"port"' | head -5
            done << 'EOF'
${n}
EOF
        `);if(!r)return new Map;let i=new Map,a=r.split(`===FILE:`).filter(e=>e.trim());for(let e of a){let t=e.split(`
`),n=t[0].replace(`===`,``).trim(),r=t.slice(1).join(`
`),a=`unknown`,o=``,s=``,c=r.match(/"protocol"\s*:\s*"([^"]+)"/);c&&(a=c[1]);let l=r.match(/"address"\s*:\s*"([^"]+)"/);l&&(o=l[1]);let u=r.match(/"port"\s*:\s*(\d+)/);u&&(s=u[1]),i.set(n,{protocol:a,address:o,port:s})}return i}static async saveConfig(e,t){let n=t.replace(/'/g,`'\\''`);await f.exec(`echo '${n}' > '${f.MODULE_PATH}/config/xray/outbounds/${e}'`)}static async deleteConfig(e){try{return await f.exec(`rm '${f.MODULE_PATH}/config/xray/outbounds/${e}'`),{success:!0}}catch(e){return{success:!1,error:e.message}}}static async switchConfig(e){let t=`${f.MODULE_PATH}/config/xray/outbounds/${e}`;(await f.exec(`pidof -s /data/adb/modules/netproxy/bin/xray 2>/dev/null || echo`)).trim()===``?await f.exec(`sed -i 's|^CURRENT_CONFIG=.*|CURRENT_CONFIG="${t}"|' ${f.MODULE_PATH}/config/module.conf`):await f.exec(`sh ${f.MODULE_PATH}/scripts/core/switch-config.sh '${t}'`)}static async importFromNodeLink(e){try{let t=e.replace(/'/g,`'\\''`);return{success:!0,output:await f.exec(`cd '${f.MODULE_PATH}/config/xray/outbounds' && chmod +x '${f.MODULE_PATH}/bin/proxylink' && '${f.MODULE_PATH}/bin/proxylink' -parse '${t}' -insecure -format xray -auto`)}}catch(e){return console.error(`Import from node link error:`,e),{success:!1,error:e.message}}}static async getSubscriptions(){try{let e=await f.exec(`find ${f.MODULE_PATH}/config/xray/outbounds -mindepth 1 -maxdepth 1 -type d -name 'sub_*' -exec basename {} \\;`),t=[];for(let n of e.split(`
`).filter(e=>e)){let e=n.replace(/^sub_/,``);try{let r=await f.exec(`cat ${f.MODULE_PATH}/config/xray/outbounds/${n}/_meta.json`),i=JSON.parse(r),a=await f.exec(`find ${f.MODULE_PATH}/config/xray/outbounds/${n} -name '*.json' ! -name '_meta.json' | wc -l`);t.push({name:i.name||e,dirName:n,url:i.url,updated:i.updated,nodeCount:parseInt(a.trim())||0})}catch{}}return t}catch{return[]}}static async addSubscription(e,t){try{return await f.exec(`sh ${f.MODULE_PATH}/scripts/config/subscription.sh add "${e}" "${t}"`),{success:!0}}catch(e){return{success:!1,error:e.message}}}static async updateSubscription(e){let t=`${f.MODULE_PATH}/config/.sub_status`;return await f.exec(`rm -f ${t}`),f.spawn(`sh`,[`-c`,`sh ${f.MODULE_PATH}/scripts/config/subscription.sh update "${e}" && echo success > ${t} || echo fail > ${t}`]),await this.waitForSubscriptionComplete(t,6e4)}static async removeSubscription(e){try{return await f.exec(`sh ${f.MODULE_PATH}/scripts/config/subscription.sh remove '${e}'`),{success:!0}}catch(e){throw Error(e.message||`删除订阅失败`)}}static async waitForSubscriptionComplete(e,t){let n=Date.now();for(;Date.now()-n<t;){await new Promise(e=>setTimeout(e,500));try{let t=await f.exec(`cat ${e} 2>/dev/null || echo ""`);if(t.trim()===`success`)return await f.exec(`rm -f ${e}`),{success:!0};if(t.trim()===`fail`)throw await f.exec(`rm -f ${e}`),Error(`订阅操作失败`)}catch{}}throw Error(`操作超时`)}},w=class{ui;currentOpenDropdown;_tabEventBound;_cachedGroups;_cachedCurrentConfig;_cachedConfigInfos;_latencyCache;_loadingChunks;_selectedTab;observer;_tabChangeHandler;constructor(e){this.ui=e,this.currentOpenDropdown=null,this._tabEventBound=!1,this._cachedGroups=null,this._cachedCurrentConfig=null,this._cachedConfigInfos=new Map,this._latencyCache=new Map,this._loadingChunks=new Set,this._selectedTab=null,this._tabChangeHandler=null,this.observer=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){let t=e.target,n=t.dataset.groupName,r=t.dataset.filename;n&&r&&this.loadConfigForItem(t,n,r),this.observer.unobserve(t)}})},{rootMargin:`200px`})}parseOutboundInfo(e){try{let t=JSON.parse(e).outbounds||[];for(let e of t){let t=e.protocol;if(!t||[`freedom`,`blackhole`,`dns`].includes(t))continue;let n=``,r=``;return e.settings&&(e.settings.vnext&&e.settings.vnext[0]?(n=e.settings.vnext[0].address||``,r=e.settings.vnext[0].port||``):e.settings.servers&&e.settings.servers[0]&&(n=e.settings.servers[0].address||``,r=e.settings.servers[0].port||``)),{protocol:t,address:n,port:r}}return{protocol:`direct`,address:v.t(`config.parser.direct`),port:``}}catch{return{protocol:`unknown`,address:``,port:``}}}async update(e=!1){try{if(!e&&this._cachedGroups&&this._cachedGroups.length>0){await this.render();return}this._cachedGroups=await C.getConfigGroups();let{config:t}=await p.getStatus();this._cachedCurrentConfig=t,await this.render()}catch{}}async loadConfigForItem(e,t,n){let r=this._cachedGroups.find(e=>e.name===t);if(!r)return;this._cachedConfigInfos.has(t)||this._cachedConfigInfos.set(t,new Map);let i=this._cachedConfigInfos.get(t);if(!i)return;let a=i.get(n);if(a&&a.protocol!==`loading...`){this.updateItemUI(e,a);return}let o=r.configs.indexOf(n);if(o===-1)return;let s=Math.floor(o/20),c=`${t}:${s}`;if(this._loadingChunks.has(c))return;this._loadingChunks.add(c);let l=s*20,u=Math.min((s+1)*20,r.configs.length),d=r.configs.slice(l,u).filter(e=>{let t=i.get(e);return!t||t.protocol===`loading...`});if(d.length===0)return;d.forEach(e=>i.set(e,{protocol:`loading...`,address:``,port:``}));let f=d.map(e=>r.dirName?`${r.dirName}/${e}`:e),p=await C.batchReadConfigInfos(f);for(let[e,n]of p){i.set(e,n);let r=document.querySelector(`.config-item[data-group-name="${t}"][data-filename="${e}"]`);r&&this.updateItemUI(r,n)}this._loadingChunks.delete(c)}updateItemUI(e,t){let n=e.querySelector(`.protocol-line`);n&&(n.textContent=(t.protocol||v.t(`config.parser.unknown`)).toUpperCase());let r=e.querySelector(`.address-span`);r&&(r.textContent=t.port?`${t.address}:${t.port}`:t.address)}setLatencyDisplay(e,t){if(!e||!t)return;e.textContent=t.latencyStr;let n=parseInt(t.latencyStr);isNaN(n)?(t.latencyStr===`failed`||t.latencyStr===`timeout`)&&(e.style.color=`#f44336`):n<100?e.style.color=`#4caf50`:n<300?e.style.color=`#ff9800`:e.style.color=`#f44336`}async loadConfigChunk(e,t=0,n=20){let r=this._cachedGroups.find(t=>t.name===e);if(!r||r.configs.length===0)return;this._cachedConfigInfos.has(e)||this._cachedConfigInfos.set(e,new Map);let i=this._cachedConfigInfos.get(e),a=Math.min(t+n,r.configs.length),o=r.configs.slice(t,a).filter(e=>{let t=i.get(e);return!t||t.protocol===`loading...`});if(o.length===0)return;o.forEach(e=>i.set(e,{protocol:`loading...`,address:``,port:``}));let s=o.map(e=>r.dirName?`${r.dirName}/${e}`:e),c=await C.batchReadConfigInfos(s);for(let[t,n]of c){i.set(t,n);let r=document.querySelector(`.config-item[data-group-name="${e}"][data-filename="${t}"]`);r&&this.updateItemUI(r,n)}}async render(){let e=document.getElementById(`config-tabs`);if(!e)return;if(!this._cachedGroups||this._cachedGroups.length===0){e.innerHTML=`<mdui-tab value="empty">暂无节点</mdui-tab><mdui-tab-panel slot="panel" value="empty"><p style="padding: 16px; text-align: center;">暂无节点</p></mdui-tab-panel>`;return}let t=this._selectedTab||this._cachedGroups[0]?.name||`default`,n=e.querySelectorAll(`mdui-tab`),r=Array.from(n).map(e=>e.value),i=this._cachedGroups.map(e=>e.name);if(r.length===i.length&&r.every((e,t)=>e===i[t])&&r.length>0&&r[0]!==`loading`){let e=this._cachedGroups.find(e=>e.name===t)?t:this._cachedGroups[0]?.name;this._selectedTab=e,await this.renderActiveTab(e);return}e.innerHTML=``;for(let t of this._cachedGroups){let n=document.createElement(`mdui-tab`);n.value=t.name,n.textContent=`${t.name} (${t.configs.length})`,e.appendChild(n)}requestAnimationFrame(()=>{let t=e.shadowRoot;if(t){let e=t.querySelector(`[part="container"]`);e&&(e.style.cssText=`display: flex; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch;`),t.querySelectorAll(`slot`).forEach(e=>{e.assignedElements().forEach(e=>{e.tagName===`MDUI-TAB`&&(e.style.cssText=`flex-shrink: 0; white-space: nowrap;`)})})}e.querySelectorAll(`mdui-tab`).forEach(e=>{e.style.cssText=`flex-shrink: 0; white-space: nowrap;`})});for(let t of this._cachedGroups){let n=document.createElement(`mdui-tab-panel`);n.slot=`panel`,n.value=t.name;let r=document.createElement(`div`);r.style.cssText=`display: flex; justify-content: space-between; align-items: center; padding: 12px 16px 4px 16px;`;let i=document.createElement(`span`);i.textContent=v.t(`config.node_list`),i.setAttribute(`data-i18n`,`config.node_list`),i.style.cssText=`font-size: 14px; font-weight: 500; color: var(--mdui-color-on-surface-variant);`,r.appendChild(i);let a=document.createElement(`mdui-dropdown`);a.setAttribute(`placement`,`bottom-end`);let o=document.createElement(`mdui-button-icon`);o.slot=`trigger`,o.setAttribute(`icon`,`more_vert`),a.appendChild(o);let s=document.createElement(`mdui-menu`),c=document.createElement(`mdui-menu-item`);c.innerHTML=`<mdui-icon slot="icon" name="playlist_play"></mdui-icon>${v.t(`config.menu.test_all`)}`,c.addEventListener(`click`,()=>{a.open=!1,this.testGroupLatency(t.name)}),s.appendChild(c);let l=document.createElement(`mdui-menu-item`);l.innerHTML=`<mdui-icon slot="icon" name="sort"></mdui-icon>${v.t(`config.menu.sort`)}`,l.addEventListener(`click`,()=>{a.open=!1,this.sortGroupNodes(t.name)}),s.appendChild(l);let u=document.createElement(`mdui-menu-item`);if(u.innerHTML=`<mdui-icon slot="icon" name="delete_sweep"></mdui-icon>${v.t(`config.menu.clean`)}`,u.style.color=`var(--mdui-color-error)`,u.addEventListener(`click`,()=>{a.open=!1,this.deleteInvalidNodes(t.name)}),s.appendChild(u),t.type===`subscription`){let e=document.createElement(`mdui-menu-item`);e.innerHTML=`<mdui-icon slot="icon" name="refresh"></mdui-icon>${v.t(`config.menu.update_sub`)}`,e.addEventListener(`click`,()=>{a.open=!1,this.updateSubscription(t.dirName,t.name)}),s.appendChild(e);let n=document.createElement(`mdui-menu-item`);n.innerHTML=`<mdui-icon slot="icon" name="delete"></mdui-icon>${v.t(`config.menu.delete_sub`)}`,n.addEventListener(`click`,()=>{a.open=!1,this.deleteSubscription(t.dirName,t.name)}),s.appendChild(n)}a.appendChild(s),r.appendChild(a),n.appendChild(r);let d=document.createElement(`mdui-list`);d.id=`config-list-${t.name}`,d.className=`config-group-list`,n.appendChild(d),e.appendChild(n)}let a=this._cachedGroups.find(e=>e.name===t)?t:this._cachedGroups[0]?.name;this._selectedTab=a,requestAnimationFrame(()=>{setTimeout(async()=>{if(a){let t=e.querySelector(`mdui-tab[value="${a}"]`);t&&t.click(),await this.renderActiveTab(a)}},100)}),this._tabChangeHandler&&e.removeEventListener(`change`,this._tabChangeHandler),this._tabChangeHandler=async e=>{let t=e.target?.value;t&&(this._selectedTab=t,await this.renderActiveTab(t))},e.addEventListener(`change`,this._tabChangeHandler)}async renderActiveTab(e){let t=this._cachedGroups.find(t=>t.name===e);if(!t)return;let n=document.getElementById(`config-list-${e}`);if(!n)return;this._cachedConfigInfos.has(e)||(this._cachedConfigInfos.set(e,new Map),await this.loadConfigChunk(e,0,10));let r=this._cachedConfigInfos.get(e)||new Map,i=document.createDocumentFragment();for(let e of t.configs){let n=r.get(e),a=t.dirName?`${t.dirName}/${e}`:e,o=this._cachedCurrentConfig&&this._cachedCurrentConfig.endsWith(e);this.renderConfigItem(i,e,a,n,o,t)}n.innerHTML=``,n.appendChild(i)}async loadConfigInfos(e){let t=e.configs.map(t=>e.dirName?`${e.dirName}/${t}`:t);return await C.batchReadConfigInfos(t)}renderConfigItem(e,t,n,r,i,a){let o=document.createElement(`mdui-list-item`);o.setAttribute(`clickable`,``),o.classList.add(`config-item`),o.dataset.groupName=a.name,o.dataset.filename=t,o.dataset.filename=t;let s=t.replace(/\.json$/i,``);o.setAttribute(`headline`,s);let c=document.createElement(`div`);c.slot=`description`,c.style.cssText=`display: flex; flex-direction: column; gap: 2px; width: 100%;`;let l=document.createElement(`div`);l.style.cssText=`display: flex; justify-content: space-between; align-items: center;`;let u=document.createElement(`span`);u.className=`address-span`,u.style.cssText=`color: var(--mdui-color-on-surface-variant); font-size: 13px; flex: 1; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-right: 8px;`,u.textContent=r?r.port?`${r.address}:${r.port}`:r.address:``,l.appendChild(u),c.appendChild(l);let d=document.createElement(`div`);d.style.cssText=`color: var(--mdui-color-primary); font-size: 12px; font-weight: 500; margin-top: 2px; display: flex; align-items: center; gap: 8px;`;let f=document.createElement(`span`);if(f.className=`protocol-line`,f.textContent=r?(r.protocol||v.t(`config.parser.unknown`)).toUpperCase():`LOADING...`,d.appendChild(f),i){let e=document.createElement(`span`);e.textContent=v.t(`config.status.current`),e.className=`current-tag-text`,e.style.cssText=`font-size: 10px; padding: 1px 4px; border-radius: 4px; background: var(--mdui-color-primary);`,d.appendChild(e)}c.appendChild(d),r||this.observer.observe(o);let p=document.createElement(`span`);p.style.cssText=`display: flex; align-items: center; gap: 6px;`;let m=document.createElement(`span`);m.className=`latency-label`,m.style.cssText=`font-size: 12px; color: var(--mdui-color-on-surface-variant);`;let h=this._latencyCache.get(t);h&&(m.textContent=h.latencyStr,this.setLatencyDisplay(m,h)),p.appendChild(m),l.appendChild(p),o.appendChild(c);let g=document.createElement(`mdui-dropdown`);g.setAttribute(`placement`,`bottom-end`),g.slot=`end-icon`;let _=document.createElement(`mdui-button-icon`);_.setAttribute(`slot`,`trigger`),_.setAttribute(`icon`,`more_vert`),_.addEventListener(`click`,e=>{e.stopPropagation(),this.currentOpenDropdown&&this.currentOpenDropdown!==g&&(this.currentOpenDropdown.open=!1),this.currentOpenDropdown=g}),_.addEventListener(`mousedown`,e=>e.stopPropagation()),_.addEventListener(`pointerdown`,e=>e.stopPropagation()),_.addEventListener(`touchstart`,e=>e.stopPropagation()),g.appendChild(_),g.addEventListener(`closed`,()=>{this.currentOpenDropdown===g&&(this.currentOpenDropdown=null)});let y=document.createElement(`mdui-menu`),b=document.createElement(`mdui-menu-item`);b.innerHTML=`<mdui-icon slot="icon" name="edit"></mdui-icon>${v.t(`config.menu.edit`)}`,b.addEventListener(`click`,async e=>{e.stopPropagation(),g.open=!1,await this.ui.showConfigDialog(n)}),y.appendChild(b);let x=document.createElement(`mdui-menu-item`);if(x.innerHTML=`<mdui-icon slot="icon" name="speed"></mdui-icon>${v.t(`config.menu.test`)}`,x.addEventListener(`click`,async e=>{e.stopPropagation(),g.open=!1,await this.testConfig(s,r.address,o)}),y.appendChild(x),!i){let e=document.createElement(`mdui-menu-item`);e.innerHTML=`<mdui-icon slot="icon" name="delete"></mdui-icon>${v.t(`config.menu.delete`)}`,e.style.color=`var(--mdui-color-error)`,e.addEventListener(`click`,async e=>{e.stopPropagation(),g.open=!1,await this.deleteConfig(n,s)}),y.appendChild(e)}g.appendChild(y),o.appendChild(g),o.addEventListener(`click`,()=>{i||this.switchConfig(n,s)}),e.appendChild(o)}async testConfig(e,t,n){let r=n?.querySelector(`.latency-label`);if(!t||t===v.t(`config.parser.direct`)){r&&(r.textContent=v.t(`config.status.direct`));return}try{r&&(r.textContent=v.t(`config.status.testing`),r.style.color=`var(--mdui-color-on-surface-variant)`);let i=await p.getPingLatency(t),a=9999,o=i===`timeout`?v.t(`config.status.timeout`):i===`failed`?v.t(`config.status.failed`):i,s=parseInt(i);isNaN(s)||(a=s);let c={latency:a,latencyStr:i};r&&(r.textContent=o,this.setLatencyDisplay(r,c));let l=n?.dataset.filename||e+`.json`;this._latencyCache.set(l,c)}catch{r&&(r.textContent=v.t(`config.status.failed`),r.style.color=`#f44336`)}}async testGroupLatency(e){if(!this._cachedGroups.find(t=>t.name===e))return;let t=document.getElementById(`config-list-${e}`);if(!t)return;let n=Array.from(t.querySelectorAll(`.config-item`)),r=n.length;if(r===0){y(v.t(`config.toast.no_nodes`));return}y(v.t(`config.toast.start_test`,{count:String(r)}),!0),await Promise.all(n.map(async t=>{let n=t.dataset.filename,r=this._cachedConfigInfos.get(e)?.get(n);r&&r.address&&await this.testConfig(n.replace(/\.json$/i,``),r.address,t)})),y(v.t(`config.toast.test_complete`))}async sortGroupNodes(e){let t=this._cachedGroups.find(t=>t.name===e);t&&this._cachedConfigInfos.get(e)&&(t.configs.sort((e,t)=>(this._latencyCache.get(e)?.latency??99999)-(this._latencyCache.get(t)?.latency??99999)),y(v.t(`config.toast.sorted`)),await this.renderActiveTab(e))}async deleteInvalidNodes(e){let t=this._cachedConfigInfos.get(e);if(!t){y(v.t(`config.toast.need_test`));return}let n=[];for(let[e,r]of t.entries()){let t=this._latencyCache.get(e);t&&(t.latencyStr===`failed`||t.latencyStr===`timeout`)&&(n.push(e),this._latencyCache.delete(e))}if(n.length===0){y(v.t(`config.toast.no_invalid`));return}if(!await this.ui.confirm(v.t(`config.confirm.clean_invalid`,{count:n.length})))return;let r=this._cachedGroups.find(t=>t.name===e),i=0;for(let e of n){let t=r.dirName?`${r.dirName}/${e}`:e,n=await C.deleteConfig(t);n&&n.success&&i++}y(v.t(`config.toast.clean_success`,{count:i})),this._cachedConfigInfos.delete(e),this.update()}async deleteConfig(e,t){try{if(!await this.ui.confirm(v.t(`config.confirm.delete_node`,{name:t})))return;let n=await C.deleteConfig(e);n&&n.success?(y(v.t(`config.toast.deleted`)),this._cachedGroups=null,this._cachedConfigInfos.clear(),await this.update(!0)):y(v.t(`config.toast.delete_failed`)+(n?.error||v.t(`common.unknown`)))}catch(e){y(v.t(`config.toast.delete_failed`)+e.message)}}async switchConfig(e,t){try{await C.switchConfig(e),y(v.t(`config.toast.switch_success`)+t),this._cachedCurrentConfig=e,this._selectedTab&&await this.renderActiveTab(this._selectedTab),await this.ui.statusPage.update()}catch(e){y(v.t(`config.toast.switch_failed`)+e.message)}}async updateSubscription(e,t){y(v.t(`config.toast.updating_sub`)),setTimeout(async()=>{try{await C.updateSubscription(t),y(v.t(`config.toast.sub_updated`)),this._cachedConfigInfos.delete(t),this.update()}catch(e){y(v.t(`config.toast.update_failed`)+e.message),this.update()}},50)}async deleteSubscription(e,t){try{if(!await this.ui.confirm(v.t(`config.confirm.delete_sub`,{name:t})))return;await C.removeSubscription(t),y(v.t(`config.toast.sub_deleted`)),this._cachedGroups=null,this._cachedConfigInfos.clear(),await this.update(!0)}catch(e){y(v.t(`config.toast.delete_failed`)+e.message)}}async addSubscription(){let e=document.getElementById(`subscription-dialog`),t=document.getElementById(`subscription-name`),n=document.getElementById(`subscription-url`);t&&(t.value=``),n&&(n.value=``),e&&(e.open=!0)}async saveSubscription(){let e=document.getElementById(`subscription-name`),t=document.getElementById(`subscription-url`);document.getElementById(`subscription-save`),document.getElementById(`subscription-cancel`);let n=document.getElementById(`subscription-dialog`);if(!e||!t)return;let r=e.value.trim(),i=t.value.trim();if(!r){y(v.t(`config.toast.enter_sub_name`));return}if(!i){y(v.t(`config.toast.enter_sub_url`));return}n&&(n.open=!1),e.value=``,t.value=``,y(v.t(`config.toast.downloading_sub`)),setTimeout(async()=>{try{await C.addSubscription(r,i),y(v.t(`config.toast.sub_added`)),this._cachedGroups=null,this._cachedConfigInfos.clear(),await this.update(!0)}catch(e){y(v.t(`config.toast.add_failed`)+e.message)}},50)}async showDialog(e=null){let t=document.getElementById(`config-dialog`),n=document.getElementById(`config-filename`),r=document.getElementById(`config-content`);!n||!r||(e?(n.value=e,n.disabled=!0,r.value=await C.readConfig(e)):(n.value=``,n.disabled=!1,r.value=JSON.stringify({outbounds:[{protocol:`vless`,tag:`proxy`,settings:{vnext:[{address:``,port:443,users:[{id:``}]}]}},{protocol:`freedom`,tag:`direct`},{protocol:`blackhole`,tag:`block`}]},null,2)),t&&(t.open=!0))}async saveConfig(){let e=document.getElementById(`config-filename`),t=document.getElementById(`config-content`);if(!e||!t)return;let n=e.value.trim(),r=t.value;if(!n){y(v.t(`config.toast.enter_filename`));return}if(!n.endsWith(`.json`)){y(v.t(`config.toast.filename_json`));return}try{JSON.parse(r),await C.saveConfig(n,r),y(v.t(`config.toast.save_success`));let e=document.getElementById(`config-dialog`);e&&(e.open=!1),this.update()}catch(e){y(v.t(`config.toast.save_failed`)+e.message)}}async importNodeLink(){let e=document.getElementById(`node-link-input`);if(!e)return;let t=e.value.trim();if(!t){y(v.t(`config.toast.enter_link`));return}if(![`vless://`,`vmess://`,`trojan://`,`ss://`,`socks://`,`http://`,`https://`,`hysteria2://`,`hy2://`].some(e=>t.startsWith(e))){y(v.t(`config.toast.unsupported_link`));return}try{let n=await C.importFromNodeLink(t);if(n.success){y(v.t(`config.toast.import_success`));let t=document.getElementById(`node-link-dialog`);t&&(t.open=!1),e.value=``,this._cachedGroups=null,this._cachedConfigInfos.clear(),await this.update(!0)}else y(v.t(`config.toast.import_failed`)+(n.error||v.t(`common.unknown`)))}catch(e){y(v.t(`config.toast.import_failed`)+e.message)}}},T=class{static async getAppProxyMode(){try{let e=(await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`)).match(/^APP_PROXY_MODE="?(\w+)"?/m);return e?e[1]:`blacklist`}catch{return`blacklist`}}static async setAppProxyMode(e){await f.exec(`sed -i 's/^APP_PROXY_MODE=.*/APP_PROXY_MODE="${e}"/' ${f.MODULE_PATH}/config/tproxy.conf`)}static async getAppProxyEnabled(){try{let e=(await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`)).match(/^APP_PROXY_ENABLE=(\d+)/m);return e?e[1]===`1`:!0}catch{return!0}}static async setAppProxyEnabled(e){let t=e?`1`:`0`;await f.exec(`sed -i 's/^APP_PROXY_ENABLE=.*/APP_PROXY_ENABLE=${t}/' ${f.MODULE_PATH}/config/tproxy.conf`)}static async getUsers(){try{let e=await f.exec(`pm list users`),t=[],n=e.split(`
`);for(let e of n){let n=e.match(/UserInfo\{(\d+):([^:]+):/);n&&t.push({id:n[1],name:n[2]})}return t}catch(e){return console.error(`Failed to get users:`,e),[{id:`0`,name:`Owner`}]}}static async getInstalledApps(e=`0`,t=!1){let n=`pm list packages --user ${e} ${t?`-s`:`-3`}`;try{let t=(await f.exec(n)).split(`
`),r=[];for(let n of t){let t=n.replace(/^package:/,``).trim();t&&r.push({packageName:t,appLabel:t,userId:e,icon:null})}return r}catch(e){return console.error(`Failed to get installed apps:`,e),[]}}static async fetchAppDetails(e,t=10){let n=[...new Set(e.map(e=>e.packageName))];if(n.length===0)return e;for(let r=0;r<t;r++)try{let t=f.getPackagesInfo(n);if(!t||t.length===0){console.warn(`fetchAppDetails attempt ${r+1}: empty result, retrying...`),await new Promise(e=>setTimeout(e,300));continue}let i=new Map;if(t.forEach(e=>i.set(e.packageName,e)),e.forEach(e=>{let t=i.get(e.packageName);t&&(e.appLabel=t.appLabel||e.appLabel,e.icon=`ksu://icon/${e.packageName}`)}),e.some(e=>e.appLabel&&e.appLabel!==e.packageName))return e;console.warn(`fetchAppDetails attempt ${r+1}: no labels populated, retrying...`),await new Promise(e=>setTimeout(e,300))}catch(e){console.warn(`fetchAppDetails attempt ${r+1} failed:`,e),r<t-1&&await new Promise(e=>setTimeout(e,300))}return e}static async getProxyApps(){try{let e=await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`),t=((e.match(/APP_PROXY_MODE="?(\w+)"?/)||[])[1]||`blacklist`)===`blacklist`?`BYPASS_APPS_LIST`:`PROXY_APPS_LIST`,n=e.match(RegExp(`${t}="([^"]*)"`));return n&&n[1]?n[1].split(` `).filter(e=>e.trim()).map(e=>{let t=e.split(`:`);return t.length===2?{userId:t[0],packageName:t[1]}:{userId:`0`,packageName:e}}):[]}catch{return[]}}static async addProxyApp(e,t=`0`){let n=await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`),r=((n.match(/APP_PROXY_MODE="?(\w+)"?/)||[])[1]||`blacklist`)===`blacklist`?`BYPASS_APPS_LIST`:`PROXY_APPS_LIST`,i=n.match(RegExp(`${r}="([^"]*)"`)),a=i?i[1]:``,o=a.split(` `).filter(e=>e.trim()),s=`${t}:${e}`;if(o.includes(s))return;let c=o.length>0?`${a} ${s}`:s;await f.exec(`sed -i 's/${r}="[^"]*"/${r}="${c}"/' ${f.MODULE_PATH}/config/tproxy.conf`)}static async removeProxyApp(e,t=`0`){let n=await f.exec(`cat ${f.MODULE_PATH}/config/tproxy.conf`),r=((n.match(/APP_PROXY_MODE="?(\w+)"?/)||[])[1]||`blacklist`)===`blacklist`?`BYPASS_APPS_LIST`:`PROXY_APPS_LIST`,i=n.match(RegExp(`${r}="([^"]*)"`)),a=(i?i[1]:``).split(` `).filter(e=>e.trim()),o=`${t}:${e}`,s=a.filter(n=>n===e&&t===`0`?!1:n!==o).join(` `);await f.exec(`sed -i 's/${r}="[^"]*"/${r}="${s}"/' ${f.MODULE_PATH}/config/tproxy.conf`)}},E=class{ui;allApps;proxyMode;proxyApps;selectedApps;originalProxyApps;users;currentUserId;showSystemApps;appProxyEnabled;isUpdatingUI;constructor(e){this.ui=e,this.allApps=[],this.proxyMode=`blacklist`,this.proxyApps=[],this.selectedApps=new Map,this.originalProxyApps=new Map,this.users=[],this.currentUserId=`0`,this.showSystemApps=!1,this.appProxyEnabled=!0,this.isUpdatingUI=!1}async init(){let e=document.getElementById(`app-proxy-mode-group`);e&&e.addEventListener(`change`,async()=>{if(this.isUpdatingUI)return;let t=e.value;await this.handleProxyModeChange(t)});let t=document.getElementById(`app-selector-search`);t&&t.addEventListener(`input`,()=>this.filterApps(t.value));let n=document.getElementById(`app-selector-user`);n&&n.addEventListener(`change`,()=>{this.currentUserId=n.value,this.reloadAppList()});let r=document.getElementById(`app-selector-show-system`);r&&r.addEventListener(`change`,()=>{this.showSystemApps=r.checked,this.reloadAppList()})}async update(e=!1){try{let t=document.getElementById(`uid-list`);document.getElementById(`proxy-mode-switch`),document.getElementById(`proxy-mode-desc`);let n=document.getElementById(`proxy-list-title`);if(!e&&this.proxyApps.length>0||!t)return;let r=t.children.length>0?t.children.length:1;this.ui.showSkeleton(t,r);let[i,a]=await Promise.all([T.getAppProxyMode(),T.getAppProxyEnabled()]);this.proxyMode=i,this.appProxyEnabled=a;let o=`off`;this.appProxyEnabled&&(o=this.proxyMode);let s=document.getElementById(`app-proxy-mode-group`);s&&(this.isUpdatingUI=!0,s.value=o,setTimeout(()=>{this.isUpdatingUI=!1},100));let c=document.getElementById(`proxy-list-card`);if(c&&(o===`off`?c.style.display=`none`:c.style.display=`block`),n&&o!==`off`&&(n.textContent=this.proxyMode===`blacklist`?v.t(`uid.title_blacklist`):v.t(`uid.title_whitelist`)),this.proxyApps=await T.getProxyApps(),this.proxyApps.length===0){t.innerHTML=`<mdui-list-item><div slot="headline">${this.proxyMode===`blacklist`?v.t(`uid.empty_blacklist`):v.t(`uid.empty_whitelist`)}</div></mdui-list-item>`;return}this.proxyApps=await T.fetchAppDetails(this.proxyApps);let l=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){let t=e.target,n=t.querySelector(`img.app-icon`);if(n&&!n.src){let e=n.dataset.iconUrl,r=n.dataset.packageName;n.dataset.userId,e?(n.src=e,n.onload=()=>{n.style.display=`block`;let e=t.querySelector(`mdui-icon[slot="icon"]`);e&&(e.style.display=`none`)}):r&&(n.src=`ksu://icon/${r}`,n.onload=()=>{n.style.display=`block`;let e=t.querySelector(`mdui-icon[slot="icon"]`);e&&(e.style.display=`none`)})}l.unobserve(t)}})},{rootMargin:`100px`,threshold:.1});t.innerHTML=``,this.proxyApps.forEach(e=>{let n=document.createElement(`mdui-list-item`),r=e.appLabel||e.packageName,i=e.userId===`0`?r:`${r} [${v.t(`uid.user_label`)} ${e.userId}]`;if(n.setAttribute(`headline`,i),r!==e.packageName){let t=document.createElement(`span`);t.slot=`description`,t.className=`package-name-wrap`,t.textContent=e.packageName,n.appendChild(t)}let a=document.createElement(`mdui-icon`);a.slot=`icon`,a.setAttribute(`name`,`android`),n.appendChild(a);let o=document.createElement(`img`);o.slot=`icon`,o.className=`app-icon`,o.style.display=`none`,o.dataset.packageName=e.packageName,o.dataset.userId=e.userId,e.icon&&(o.dataset.iconUrl=e.icon),o.onerror=function(){this.style.display=`none`;let e=this.parentElement?.querySelector(`mdui-icon[slot="icon"]`);e&&(e.style.display=``)},n.appendChild(o),l.observe(n);let s=document.createElement(`mdui-button-icon`);s.slot=`end-icon`,s.setAttribute(`icon`,`delete`),s.style.color=`var(--mdui-color-error)`,s.addEventListener(`click`,async t=>{t.stopPropagation(),await this.removeApp(e.packageName,e.userId,r)}),n.appendChild(s),t.appendChild(n)})}catch(e){console.error(`Update proxy page failed:`,e)}}async handleProxyModeChange(e){try{e===`off`?(await T.setAppProxyEnabled(!1),this.appProxyEnabled=!1,y(v.t(`uid.toast_proxy_disabled`))):(await T.setAppProxyEnabled(!0),await T.setAppProxyMode(e),this.appProxyEnabled=!0,this.proxyMode=e,y(v.t(`uid.toast_mode_switched`)+(e===`blacklist`?v.t(`uid.mode_blacklist`):v.t(`uid.mode_whitelist`)))),this.update(!0)}catch(e){y(v.t(`common.set_failed`)+e.message,!0)}}async removeApp(e,t=`0`,n=null){let r=t.toString(),i=r===`0`?``:`(用户 ${r})`,a=n||e;if(await this.ui.confirm(v.t(`uid.confirm_remove`,{name:a+(i?` `+i:``)})))try{await T.removeProxyApp(e,r),y(v.t(`uid.toast_removed`)),this.proxyApps=[],await this.update(!0)}catch(e){y(v.t(`uid.toast_remove_failed`)+e.message,!0)}}async reloadAppList(){let e=document.getElementById(`app-selector-list`);if(e){this.ui.showSkeleton(e,5);try{this.allApps=await T.getInstalledApps(this.currentUserId,this.showSystemApps),this.allApps=await T.fetchAppDetails(this.allApps),this.renderAppList(this.allApps)}catch(t){e.innerHTML=`<mdui-list-item><div slot="headline">${v.t(`logs.load_failed`)}</div></mdui-list-item>`,y(v.t(`uid.toast_load_apps_failed`)+t.message,!0)}}}async showAppSelector(){let e=document.getElementById(`app-selector-dialog`);document.getElementById(`app-selector-list`);let t=document.getElementById(`app-selector-add-selected`),n=document.getElementById(`app-selector-search`);n&&(n.value=``);let r=document.getElementById(`app-selector-user`);r&&(this.users=await T.getUsers(),r.innerHTML=``,this.users.forEach(e=>{let t=document.createElement(`mdui-menu-item`);t.value=e.id,t.textContent=`${e.name} (${e.id})`,r.appendChild(t)}),r.value=this.currentUserId),this.selectedApps.clear(),this.originalProxyApps.clear();for(let e of this.proxyApps){let t=`${e.userId}:${e.packageName}`,n={packageName:e.packageName,userId:e.userId,appLabel:e.appLabel,icon:e.icon};this.selectedApps.set(t,n),this.originalProxyApps.set(t,n)}this.updateAddSelectedButton(),t&&(t.onclick=()=>this.addSelectedApps()),e&&(e.open=!0),this.reloadAppList()}updateAddSelectedButton(){let e=document.getElementById(`app-selector-add-selected`);if(e){let t=this.selectedApps.size;e.textContent=v.t(`uid.btn_add_selected`,{count:String(t)}),e.disabled=!(t>0||this.originalProxyApps.size!==this.selectedApps.size)}}toggleAppSelection(e,t,n=!1){let r=`${e.userId}:${e.packageName}`;n?t.checked?this.selectedApps.set(r,e):this.selectedApps.delete(r):this.selectedApps.has(r)?(this.selectedApps.delete(r),t.checked=!1):(this.selectedApps.set(r,e),t.checked=!0),this.updateAddSelectedButton()}async addSelectedApps(){let e=[];for(let[t,n]of this.originalProxyApps)this.selectedApps.has(t)||e.push(n);let t=Array.from(this.selectedApps.values());for(let t of e)try{await T.removeProxyApp(t.packageName,t.userId)}catch{}for(let e of t)try{await T.addProxyApp(e.packageName,e.userId)}catch{}e.length>0&&t.length>0?y(v.t(`uid.toast_added_count`,{count:String(t.length)})):e.length>0?y(v.t(`uid.toast_removed`)):t.length>0&&y(v.t(`uid.toast_added_count`,{count:String(t.length)}));let n=document.getElementById(`app-selector-dialog`);n&&(n.open=!1),this.selectedApps.clear(),this.originalProxyApps.clear(),this.proxyApps=[],await this.update(!0)}renderAppList(e){let t=document.getElementById(`app-selector-list`);if(!t)return;let n=t.parentElement;if(e.length===0){t.innerHTML=`<mdui-list-item><div slot="headline">${v.t(`uid.no_apps_found`)}</div></mdui-list-item>`;return}t.innerHTML=``;let r=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){let t=e.target,n=t.querySelector(`img.app-icon`);if(n&&!n.src){let e=n.dataset.iconUrl,r=n.dataset.packageName;e?(n.src=e,n.onload=()=>{n.style.display=`block`;let e=t.querySelector(`mdui-icon[slot="icon"]`);e&&(e.style.display=`none`)}):r&&(n.src=`ksu://icon/${r}`,n.onload=()=>{n.style.display=`block`;let e=t.querySelector(`mdui-icon[slot="icon"]`);e&&(e.style.display=`none`)})}r.unobserve(t)}})},{root:n,rootMargin:`50px`,threshold:.1});e.forEach(e=>{let n=document.createElement(`mdui-list-item`);n.setAttribute(`clickable`,``),n.setAttribute(`headline`,e.appLabel||e.packageName),n.setAttribute(`description`,e.packageName);let i=document.createElement(`mdui-icon`);i.slot=`icon`,i.setAttribute(`name`,`android`),n.appendChild(i);let a=document.createElement(`img`);a.slot=`icon`,a.className=`app-icon`,a.style.display=`none`,e.icon&&(a.dataset.iconUrl=e.icon),a.dataset.packageName=e.packageName,a.onerror=function(){this.style.display=`none`;let e=this.parentElement?.querySelector(`mdui-icon[slot="icon"]`);e&&(e.style.display=``)},n.appendChild(a),r.observe(n);let o=document.createElement(`mdui-checkbox`);o.slot=`end-icon`;let s=`${e.userId}:${e.packageName}`;o.checked=this.selectedApps.has(s),n.appendChild(o),o.addEventListener(`change`,t=>{t.stopPropagation(),this.toggleAppSelection(e,o,!0)}),n.addEventListener(`click`,t=>{t.target===o||o.contains(t.target)||(t.stopPropagation(),this.toggleAppSelection(e,o,!1))}),t.appendChild(n)})}filterApps(e){if(!this.allApps)return;let t=this.allApps.filter(t=>(t.appLabel||``).toLowerCase().includes(e.toLowerCase())||t.packageName.toLowerCase().includes(e.toLowerCase()));this.renderAppList(t)}},D=`/logo.png`,O=class{ui;routingRules;editingRuleIndex;dnsConfig;editingServerIndex;editingHostKey;proxyKeys;draggedIndex;sortable;_logsSelectedTab;_logsAutoRefreshEnabled;_logsAutoRefreshInterval;_logsAutoRefreshMs;lastAppliedThemeMode;constructor(e){this.ui=e,this.routingRules=[],this.editingRuleIndex=-1,this.dnsConfig={dns:{hosts:{},servers:[]}},this.editingServerIndex=-1,this.editingHostKey=null,this.draggedIndex=null,this.sortable=null,this._logsSelectedTab=`service`,this._logsAutoRefreshEnabled=!1,this._logsAutoRefreshInterval=null,this._logsAutoRefreshMs=3e3,this.proxyKeys=[`proxy_mobile`,`proxy_wifi`,`proxy_hotspot`,`proxy_usb`,`proxy_tcp`,`proxy_udp`,`proxy_ipv6`],this.setupEventListeners(),this.setupRoutingRulesPage(),this.setupProxySettingsPage(),this.setupThemePage(),this.setupLanguagePage(),this.setupDnsPage(),this.setupLogsPage(),this.applyStoredTheme()}init(){}async update(){}setupEventListeners(){let e=document.getElementById(`settings-logs-entry`);e&&e.addEventListener(`click`,()=>{this.ui.switchPage(`logs`)});let t=document.getElementById(`logs-back-btn`);t&&t.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});let n=document.getElementById(`settings-routing-entry`);n&&n.addEventListener(`click`,()=>{this.ui.switchPage(`routing`),this.loadRoutingRules()});let r=document.getElementById(`settings-proxy-entry`);r&&r.addEventListener(`click`,()=>{this.ui.switchPage(`proxy-settings`),this.loadProxySettings()});let i=document.getElementById(`settings-module-entry`);i&&i.addEventListener(`click`,()=>{this.ui.switchPage(`module`),this.loadModuleSettings()});let a=document.getElementById(`module-back-btn`);a&&a.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});let o=document.getElementById(`module-auto-start`);o&&o.addEventListener(`change`,async e=>{let t=e.target;try{await m.setModuleSetting(`AUTO_START`,t.checked),y(v.t(`settings.module.toast_autostart`)+(t.checked?v.t(`common.enabled`):v.t(`common.disabled`)))}catch(e){y(v.t(`common.set_failed`)+e.message,!0),t.checked=!t.checked}});let s=document.getElementById(`module-oneplus-fix`);s&&s.addEventListener(`change`,async e=>{let t=e.target;try{await m.setModuleSetting(`ONEPLUS_A16_FIX`,t.checked),t.checked?(await m.executeOneplusFix(),y(v.t(`settings.module.toast_oneplus`))):y(v.t(`settings.module.toast_oneplus_disabled`))}catch(e){y(v.t(`common.set_failed`)+e.message,!0),t.checked=!t.checked}});let c=document.getElementById(`settings-theme`);c&&c.addEventListener(`click`,()=>{this.ui.switchPage(`theme`),this.loadThemeSettings()});let l=document.getElementById(`settings-language`);l&&l.addEventListener(`click`,()=>{this.ui.switchPage(`language`),this.loadLanguageSettings()});let u=document.getElementById(`settings-dns-entry`);u&&u.addEventListener(`click`,()=>{this.ui.switchPage(`dns`),this.loadDnsConfig()});let d=document.getElementById(`settings-about`);d&&d.addEventListener(`click`,()=>{this.showAboutDialog()})}setupRoutingRulesPage(){let e=document.getElementById(`routing-back-btn`);e&&e.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});let t=document.getElementById(`add-routing-rule-btn`);t&&t.addEventListener(`click`,()=>{this.showRuleDialog()});let n=document.getElementById(`rule-cancel`);n&&n.addEventListener(`click`,()=>{document.getElementById(`routing-rule-dialog`).open=!1});let r=document.getElementById(`rule-save`);r&&r.addEventListener(`click`,()=>{this.saveRule()});let i=document.getElementById(`import-clash-rules-btn`);i&&i.addEventListener(`click`,()=>{this.showClashImportDialog()});let a=document.getElementById(`clash-import-cancel`);a&&a.addEventListener(`click`,()=>{document.getElementById(`clash-import-dialog`).open=!1});let o=document.getElementById(`clash-import-confirm`);o&&o.addEventListener(`click`,()=>{this.importClashRules()});let c=document.getElementById(`routing-rules-list`);c&&(this.sortable=new s(c,{animation:200,handle:`.drag-handle`,ghostClass:`sortable-ghost`,dragClass:`sortable-drag`,forceFallback:!0,fallbackClass:`sortable-drag`,fallbackOnBody:!0,onEnd:e=>{let{oldIndex:t,newIndex:n}=e;t!==void 0&&n!==void 0&&t!==n&&this.moveRule(t,n)}}))}async loadRoutingRules(){try{this.routingRules=await m.getRoutingRules(),this.renderRoutingRules()}catch(e){console.error(`加载路由规则失败:`,e),y(v.t(`settings.routing.toast_load_failed`))}}renderRoutingRules(){let e=document.getElementById(`routing-rules-list`);if(e){if(e.innerHTML=``,this.routingRules.length===0){e.innerHTML=`
                <mdui-list-item>
                    <span slot="description">${v.t(`settings.routing.empty`)}</span>
                </mdui-list-item>
            `;return}this.routingRules.forEach((t,n)=>{let r=document.createElement(`mdui-list-item`);r.setAttribute(`data-index`,String(n));let i=[];t.domain&&i.push(`${v.t(`settings.routing.domain`)}: ${t.domain}`),t.ip&&i.push(`${v.t(`settings.routing.ip`)}: ${t.ip}`),t.port&&i.push(`${v.t(`settings.routing.port`)}: ${t.port}`),t.network&&i.push(`${v.t(`settings.routing.network`)}: ${t.network}`),t.protocol&&i.push(`${v.t(`settings.routing.protocol`)}: ${t.protocol}`);let a=i.length>0?i.join(` | `):v.t(`settings.routing.unconditional`),o={proxy:v.t(`settings.routing.outbound_proxy`),direct:v.t(`settings.routing.outbound_direct`),block:v.t(`settings.routing.outbound_block`)}[t.outboundTag]||t.outboundTag,s=document.createElement(`mdui-icon`);s.setAttribute(`slot`,`icon`),s.setAttribute(`name`,`drag_indicator`),s.classList.add(`drag-handle`),s.style.cssText=`cursor: grab; color: var(--mdui-color-on-surface-variant); touch-action: none;`,r.appendChild(s),r.setAttribute(`headline`,t.name||`${v.t(`settings.routing.rule_prefix`)}${n+1}`);let c=document.createElement(`div`);c.slot=`description`,c.style.cssText=`display: flex; justify-content: space-between; width: 100%;`;let l=document.createElement(`span`);l.textContent=a,l.style.cssText=`overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;`;let u=document.createElement(`span`);u.textContent=o,u.style.cssText=`margin-left: 8px; padding: 2px 6px; border-radius: 4px; font-size: 11px; background: var(--mdui-color-secondary-container); color: var(--mdui-color-on-secondary-container);`,c.appendChild(l),c.appendChild(u),r.appendChild(c);let d=document.createElement(`div`);d.slot=`end-icon`,d.style.cssText=`display: flex; align-items: center; gap: 4px;`;let f=document.createElement(`mdui-switch`);f.checked=t.enabled!==!1,f.addEventListener(`change`,async e=>{e.stopPropagation(),t.enabled=e.target.checked,await this.saveRulesToBackend()}),d.appendChild(f);let p=document.createElement(`mdui-dropdown`);p.setAttribute(`placement`,`bottom-end`);let m=document.createElement(`mdui-button-icon`);m.setAttribute(`slot`,`trigger`),m.setAttribute(`icon`,`more_vert`),m.addEventListener(`click`,e=>e.stopPropagation()),p.appendChild(m);let h=document.createElement(`mdui-menu`),g=document.createElement(`mdui-menu-item`);g.innerHTML=`<mdui-icon slot="icon" name="edit"></mdui-icon>${v.t(`common.edit`)}`,g.addEventListener(`click`,e=>{e.stopPropagation(),p.open=!1,this.showRuleDialog(t,n)}),h.appendChild(g);let _=document.createElement(`mdui-menu-item`);_.innerHTML=`<mdui-icon slot="icon" name="delete"></mdui-icon>${v.t(`common.delete`)}`,_.style.color=`var(--mdui-color-error)`,_.addEventListener(`click`,async e=>{e.stopPropagation(),p.open=!1,await this.ui.confirm(v.t(`settings.routing.confirm_delete`,{name:t.name||`${v.t(`settings.routing.rule_prefix`)}${n+1}`}))&&(this.routingRules.splice(n,1),await this.saveRulesToBackend(),this.renderRoutingRules())}),h.appendChild(_),p.appendChild(h),d.appendChild(p),r.appendChild(d),e.appendChild(r)})}}async moveRule(e,t){let[n]=this.routingRules.splice(e,1);this.routingRules.splice(t,0,n),await this.saveRulesToBackend(),this.renderRoutingRules(),y(v.t(`routing.toast_reordered`))}showRuleDialog(e=null,t=-1){this.editingRuleIndex=t;let n=document.getElementById(`routing-rule-dialog`);n.headline=e?v.t(`settings.routing.dialog_edit`):v.t(`settings.routing.dialog_add`),document.getElementById(`rule-name`).value=e?.name||``,document.getElementById(`rule-domain`).value=e?.domain||``,document.getElementById(`rule-ip`).value=e?.ip||``,document.getElementById(`rule-port`).value=e?.port||``,document.getElementById(`rule-protocol`).value=e?.protocol||``,document.getElementById(`rule-network`).value=e?.network||``,document.getElementById(`rule-outbound`).value=e?.outboundTag||`proxy`,n.open=!0}async saveRule(){let e=document.getElementById(`rule-name`).value.trim(),t=document.getElementById(`rule-domain`).value.trim(),n=document.getElementById(`rule-ip`).value.trim(),r=document.getElementById(`rule-port`).value.trim(),i=document.getElementById(`rule-protocol`).value.trim(),a=document.getElementById(`rule-network`).value.trim(),o=document.getElementById(`rule-outbound`).value;if(!t&&!n&&!r&&!i&&!a){y(v.t(`settings.routing.toast_input_condition`));return}let s={name:e||(this.editingRuleIndex>=0?`${v.t(`settings.routing.rule_prefix`)}${this.editingRuleIndex+1}`:`${v.t(`settings.routing.rule_prefix`)}${this.routingRules.length+1}`),type:`field`,domain:t,ip:n,port:r,protocol:i,network:a,outboundTag:o,enabled:!0};this.editingRuleIndex>=0?(s.enabled=this.routingRules[this.editingRuleIndex].enabled!==!1,this.routingRules[this.editingRuleIndex]=s):this.routingRules.push(s),await this.saveRulesToBackend(),this.renderRoutingRules(),document.getElementById(`routing-rule-dialog`).open=!1,y(this.editingRuleIndex>=0?v.t(`settings.routing.toast_updated`):v.t(`settings.routing.toast_added`))}async saveRulesToBackend(){try{await m.saveRoutingRules(this.routingRules),await m.applyRoutingRules(this.routingRules)}catch(e){console.error(`保存规则失败:`,e),y(v.t(`common.save_failed`)+e.message)}}showClashImportDialog(){let e=document.getElementById(`clash-import-dialog`);document.getElementById(`clash-rule-name`).value=``,document.getElementById(`clash-rule-url`).value=``,document.getElementById(`clash-rule-outbound`).value=`block`,e.open=!0}async importClashRules(){let e=document.getElementById(`clash-rule-name`).value.trim(),t=document.getElementById(`clash-rule-url`).value.trim(),n=document.getElementById(`clash-rule-outbound`).value;if(!t){y(v.t(`routing.toast_url_required`));return}try{y(v.t(`routing.toast_importing`));let r=await m.importClashRulesFromUrl(t);if(r.length===0){y(v.t(`routing.toast_no_domains`));return}let i={name:e||`Clash 规则 (${r.length} 条)`,type:`field`,domain:r.join(`,`),ip:``,port:``,protocol:``,network:``,outboundTag:n,enabled:!0};this.routingRules.push(i),await this.saveRulesToBackend(),this.renderRoutingRules(),document.getElementById(`clash-import-dialog`).open=!1,y(v.t(`routing.toast_imported`,{count:String(r.length)}))}catch(e){console.error(`导入 Clash 规则失败:`,e),y(v.t(`routing.toast_import_failed`)+e.message)}}setupDnsPage(){let e=document.getElementById(`dns-back-btn`);e&&e.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});let t=document.getElementById(`add-dns-server-btn`);t&&t.addEventListener(`click`,()=>{this.showServerDialog()});let n=document.getElementById(`add-dns-host-btn`);n&&n.addEventListener(`click`,()=>{this.showHostDialog()});let r=document.getElementById(`dns-server-cancel`);r&&r.addEventListener(`click`,()=>{let e=document.getElementById(`dns-server-dialog`);e&&(e.open=!1)});let i=document.getElementById(`dns-server-save`);i&&i.addEventListener(`click`,()=>{this.saveServer()});let a=document.getElementById(`dns-host-cancel`);a&&a.addEventListener(`click`,()=>{document.getElementById(`dns-host-dialog`).open=!1});let o=document.getElementById(`dns-host-save`);o&&o.addEventListener(`click`,()=>{this.saveHost()})}async loadDnsConfig(){try{this.dnsConfig=await m.getDnsConfig(),this.renderDnsServers(),this.renderDnsHosts()}catch(e){console.error(`加载 DNS 配置失败:`,e),y(v.t(`settings.dns.toast_load_failed`))}}renderDnsServers(){let e=document.getElementById(`dns-servers-list`);if(!e)return;let t=this.dnsConfig.dns?.servers||[];if(e.innerHTML=``,t.length===0){e.innerHTML=`
                <mdui-list-item>
                    <span slot="description">${v.t(`settings.dns.empty_server`)}</span>
                </mdui-list-item>
            `;return}t.forEach((t,n)=>{let r=document.createElement(`mdui-list-item`),i=typeof t==`string`,a=i?t:t.address,o=i?[]:t.domains||[],s=i?``:t.tag||``;r.setAttribute(`headline`,a);let c=[];if(o.length>0&&c.push(`${v.t(`settings.routing.domain`)}: ${o.slice(0,2).join(`, `)}${o.length>2?`...`:``}`),s&&c.push(`${v.t(`settings.dns.label_tag`)}: ${s}`),c.length>0){let e=document.createElement(`span`);e.slot=`description`,e.textContent=c.join(` | `),r.appendChild(e)}let l=document.createElement(`div`);l.slot=`end-icon`,l.style.cssText=`display: flex; align-items: center; gap: 4px;`;let u=document.createElement(`mdui-dropdown`);u.setAttribute(`placement`,`bottom-end`);let d=document.createElement(`mdui-button-icon`);d.setAttribute(`slot`,`trigger`),d.setAttribute(`icon`,`more_vert`),d.addEventListener(`click`,e=>e.stopPropagation()),u.appendChild(d);let f=document.createElement(`mdui-menu`),p=document.createElement(`mdui-menu-item`);p.innerHTML=`<mdui-icon slot="icon" name="edit"></mdui-icon>${v.t(`common.edit`)}`,p.addEventListener(`click`,e=>{e.stopPropagation(),u.open=!1,this.showServerDialog(t,n)}),f.appendChild(p);let m=document.createElement(`mdui-menu-item`);m.innerHTML=`<mdui-icon slot="icon" name="delete"></mdui-icon>${v.t(`common.delete`)}`,m.style.color=`var(--mdui-color-error)`,m.addEventListener(`click`,async e=>{e.stopPropagation(),u.open=!1,await this.ui.confirm(v.t(`settings.dns.confirm_delete_server`,{address:a}))&&(this.dnsConfig.dns.servers.splice(n,1),await this.saveDnsToBackend(),this.renderDnsServers())}),f.appendChild(m),u.appendChild(f),l.appendChild(u),r.appendChild(l),e.appendChild(r)})}renderDnsHosts(){let e=document.getElementById(`dns-hosts-list`);if(!e)return;let t=this.dnsConfig.dns?.hosts||{},n=Object.keys(t);if(e.innerHTML=``,n.length===0){e.innerHTML=`
                <mdui-list-item>
                    <span slot="description">${v.t(`settings.dns.empty_host`)}</span>
                </mdui-list-item>
            `;return}n.forEach(n=>{let r=document.createElement(`mdui-list-item`),i=t[n],a=Array.isArray(i)?i:[i];r.setAttribute(`headline`,n);let o=document.createElement(`span`);o.slot=`description`,o.textContent=a.slice(0,3).join(`, `)+(a.length>3?`...`:``),r.appendChild(o);let s=document.createElement(`div`);s.slot=`end-icon`,s.style.cssText=`display: flex; align-items: center; gap: 4px;`;let c=document.createElement(`mdui-dropdown`);c.setAttribute(`placement`,`bottom-end`);let l=document.createElement(`mdui-button-icon`);l.setAttribute(`slot`,`trigger`),l.setAttribute(`icon`,`more_vert`),l.addEventListener(`click`,e=>e.stopPropagation()),c.appendChild(l);let u=document.createElement(`mdui-menu`),d=document.createElement(`mdui-menu-item`);d.innerHTML=`<mdui-icon slot="icon" name="edit"></mdui-icon>${v.t(`common.edit`)}`,d.addEventListener(`click`,e=>{e.stopPropagation(),c.open=!1,this.showHostDialog(n,i)}),u.appendChild(d);let f=document.createElement(`mdui-menu-item`);f.innerHTML=`<mdui-icon slot="icon" name="delete"></mdui-icon>${v.t(`common.delete`)}`,f.style.color=`var(--mdui-color-error)`,f.addEventListener(`click`,async e=>{e.stopPropagation(),c.open=!1,await this.ui.confirm(v.t(`settings.dns.confirm_delete_host`,{domain:n}))&&(delete this.dnsConfig.dns.hosts[n],await this.saveDnsToBackend(),this.renderDnsHosts())}),u.appendChild(f),c.appendChild(u),s.appendChild(c),r.appendChild(s),e.appendChild(r)})}showServerDialog(e=null,t=-1){this.editingServerIndex=t;let n=document.getElementById(`dns-server-dialog`);n.headline=e?v.t(`settings.dns.server_dialog_edit`):v.t(`settings.dns.server_dialog_add`);let r=typeof e==`string`,i=e?r?e:e.address:``,a=e&&!r?(e.domains||[]).join(`, `):``,o=e&&!r?(e.expectIPs||[]).join(`, `):``,s=e&&!r?!!e.skipFallback:!1,c=e&&!r&&e.tag||``;document.getElementById(`dns-server-address`).value=i,document.getElementById(`dns-server-domains`).value=a,document.getElementById(`dns-server-expect-ips`).value=o,document.getElementById(`dns-server-skip-fallback`).checked=s,document.getElementById(`dns-server-tag`).value=c,n.open=!0}showHostDialog(e=null,t=null){this.editingHostKey=e;let n=document.getElementById(`dns-host-dialog`);n.headline=e?v.t(`settings.dns.host_dialog_edit`):v.t(`settings.dns.host_dialog_add`);let r=t?Array.isArray(t)?t.join(`, `):t:``;document.getElementById(`dns-host-domain`).value=e||``,document.getElementById(`dns-host-ip`).value=r,n.open=!0}async saveServer(){let e=document.getElementById(`dns-server-address`).value.trim(),t=document.getElementById(`dns-server-domains`).value.trim(),n=document.getElementById(`dns-server-expect-ips`).value.trim(),r=document.getElementById(`dns-server-skip-fallback`).checked,i=document.getElementById(`dns-server-tag`).value.trim();if(!e){y(v.t(`settings.dns.toast_enter_address`));return}let a=t?t.split(`,`).map(e=>e.trim()).filter(e=>e):[],o=n?n.split(`,`).map(e=>e.trim()).filter(e=>e):[],s;!a.length&&!o.length&&!r&&!i?s=e:(s={address:e},a.length&&(s.domains=a),o.length&&(s.expectIPs=o),r&&(s.skipFallback=!0),i&&(s.tag=i)),this.dnsConfig.dns||(this.dnsConfig.dns={hosts:{},servers:[]}),this.dnsConfig.dns.servers||(this.dnsConfig.dns.servers=[]),this.editingServerIndex>=0?this.dnsConfig.dns.servers[this.editingServerIndex]=s:this.dnsConfig.dns.servers.push(s),await this.saveDnsToBackend(),this.renderDnsServers(),document.getElementById(`dns-server-dialog`).open=!1,y(this.editingServerIndex>=0?v.t(`settings.dns.toast_server_updated`):v.t(`settings.dns.toast_server_added`))}async saveHost(){let e=document.getElementById(`dns-host-domain`).value.trim(),t=document.getElementById(`dns-host-ip`).value.trim();if(!e){y(v.t(`settings.dns.toast_enter_domain`));return}if(!t){y(v.t(`settings.dns.toast_enter_ip`));return}let n=t.split(`,`).map(e=>e.trim()).filter(e=>e),r=n.length===1?n[0]:n;this.dnsConfig.dns||(this.dnsConfig.dns={hosts:{},servers:[]}),this.dnsConfig.dns.hosts||(this.dnsConfig.dns.hosts={}),this.editingHostKey&&this.editingHostKey!==e&&delete this.dnsConfig.dns.hosts[this.editingHostKey],this.dnsConfig.dns.hosts[e]=r,await this.saveDnsToBackend(),this.renderDnsHosts(),document.getElementById(`dns-host-dialog`).open=!1,y(this.editingHostKey?v.t(`settings.dns.toast_host_updated`):v.t(`settings.dns.toast_host_added`))}async saveDnsToBackend(){try{await m.saveDnsConfig(this.dnsConfig)}catch(e){console.error(`保存 DNS 配置失败:`,e),y(v.t(`common.save_failed`)+e.message)}}setupProxySettingsPage(){let e=document.getElementById(`proxy-settings-back-btn`);e&&e.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});for(let e of this.proxyKeys){let t=e.replace(`_`,`-`),n=document.getElementById(t);n&&n.addEventListener(`change`,async t=>{let n=t.target.checked;await this.setProxySetting(e,n)})}let t=document.getElementById(`proxy-mode-settings`);t&&t.addEventListener(`change`,async e=>{let t=e.target.value;await this.setProxyMode(t)})}async loadProxySettings(){try{let e=await m.getProxySettings();for(let t of this.proxyKeys){let n=t.replace(`_`,`-`),r=document.getElementById(n);r&&(r.checked=e[t]===!0)}let t=await m.getProxyMode(),n=document.getElementById(`proxy-mode-settings`),r=document.getElementById(`proxy-mode-desc-settings`);n&&(n.value=String(t)),r&&this.updateProxyModeDesc(t)}catch(e){console.error(`加载代理设置失败:`,e)}}async setProxySetting(e,t){try{await m.setProxySetting(e,t),y(t?v.t(`common.enabled`):v.t(`common.disabled`))}catch(n){y(v.t(`common.set_failed`)+n.message);let r=e.replace(`_`,`-`),i=document.getElementById(r);i&&(i.checked=!t)}}async setProxyMode(e){try{await m.setProxyMode(e),this.updateProxyModeDesc(e);let t={0:v.t(`settings.proxy.mode_auto`),1:v.t(`settings.proxy.mode_tproxy`),2:v.t(`settings.proxy.mode_redirect`)};y(v.t(`settings.proxy.toast_mode_set`)+(t[e]||e))}catch(e){y(v.t(`common.set_failed`)+e.message)}}updateProxyModeDesc(e){let t=document.getElementById(`proxy-mode-desc-settings`);if(!t)return;let n={0:v.t(`settings.proxy.desc_auto`),1:v.t(`settings.proxy.desc_tproxy`),2:v.t(`settings.proxy.desc_redirect`)};t.textContent=n[String(e)]||n[0]}setupThemePage(){let e=document.getElementById(`theme-back-btn`);e&&e.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});let t=document.getElementById(`theme-mode-group`);t&&t.addEventListener(`change`,e=>{let t=e.target.value;this.applyThemeMode(t)});let n=document.getElementById(`color-palette`);n&&n.addEventListener(`click`,e=>{let t=e.target.closest(`.color-item`);if(t){let e=t.dataset.color;e&&(this.applyThemeColor(e),this.updateColorSelection(e))}}),this.setupMonetToggle()}loadThemeSettings(){let e=localStorage.getItem(`theme`)||`auto`,t=localStorage.getItem(`themeColor`)||`#6750A4`;this.lastAppliedThemeMode=e;let n=document.getElementById(`theme-mode-group`);n&&(n.value=e),this.updateColorSelection(t),this.updateMonetToggleState()}updateColorSelection(e){document.querySelectorAll(`.color-item`).forEach(t=>{t.dataset.color===e?t.classList.add(`selected`):t.classList.remove(`selected`)})}applyThemeMode(n){if(n===this.lastAppliedThemeMode)return;this.lastAppliedThemeMode=n,localStorage.setItem(`theme`,n),e(n);let r=localStorage.getItem(`themeColor`)||`#6750A4`,i=document.documentElement,a=window.matchMedia(`(prefers-color-scheme: dark)`).matches;if(n===`light`||n===`dark`){let e=n===`dark`;this.applyAllMonetVariables(r,e)}else localStorage.getItem(`monetEnabled`)===`true`?(i.classList.add(`mdui-theme-auto`),i.classList.remove(`mdui-theme-light`,`mdui-theme-dark`),this.removeAllMonetVariables(),t(r)):(i.classList.remove(`mdui-theme-auto`),i.classList.add(a?`mdui-theme-dark`:`mdui-theme-light`),this.applyAllMonetVariables(r,a));this.updateMonetToggleState();let o=n===`auto`?v.t(`settings.theme.mode_auto`):n===`light`?v.t(`settings.theme.mode_light`):v.t(`settings.theme.mode_dark`);y(v.t(`settings.theme.toast_mode_switched`)+o),this.ui.statusPage.updateSpeedChartColors()}applyThemeColor(e){localStorage.setItem(`themeColor`,e);let n=localStorage.getItem(`monetEnabled`)===`true`,r=localStorage.getItem(`theme`)||`auto`,i=r===`auto`,a=window.matchMedia(`(prefers-color-scheme: dark)`).matches;if(i)n?t(e):this.applyAllMonetVariables(e,a);else{let t=r===`dark`;this.applyAllMonetVariables(e,t)}this.updateMonetToggleState(),y(v.t(`settings.theme.toast_color_changed`)),this.ui.statusPage.updateSpeedChartColors()}applyAllMonetVariables(e,n){let r=document.documentElement;t(e);let i=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:103,g:80,b:164}},a=(e,t,n)=>({r:Math.round(e.r*n+t.r*(1-n)),g:Math.round(e.g*n+t.g*(1-n)),b:Math.round(e.b*n+t.b*(1-n))}),o=e=>`#`+[e.r,e.g,e.b].map(e=>e.toString(16).padStart(2,`0`)).join(``),s=i(e);if(r.style.setProperty(`--monet-primary`,e),r.style.setProperty(`--monet-primary-container`,e+`30`),r.style.setProperty(`--monet-on-primary`,`#ffffff`),r.style.setProperty(`--monet-on-primary-container`,e),r.style.setProperty(`--monet-secondary-container`,e+`30`),r.style.setProperty(`--monet-on-secondary-container`,e),n){let e={r:20,g:18,b:24},t={r:33,g:31,b:38},n={r:43,g:41,b:48},i={r:54,g:52,b:59},c=a(s,e,.05),l=a(s,t,.05),u=a(s,{r:29,g:27,b:32},.05),d=a(s,n,.05),f=a(s,i,.05);r.style.setProperty(`--monet-surface`,o(c)),r.style.setProperty(`--monet-on-surface`,`#e6e0e9`),r.style.setProperty(`--monet-surface-variant`,`#49454f`),r.style.setProperty(`--monet-on-surface-variant`,`#cac4d0`),r.style.setProperty(`--monet-surface-container`,o(l)),r.style.setProperty(`--monet-surface-container-low`,o(u)),r.style.setProperty(`--monet-surface-container-high`,o(d)),r.style.setProperty(`--monet-surface-container-highest`,o(f)),r.style.setProperty(`--monet-background`,o(c)),r.style.setProperty(`--monet-on-background`,`#e6e0e9`),r.style.setProperty(`--monet-outline`,`#938f99`),r.style.setProperty(`--monet-outline-variant`,`#49454f`),r.style.setProperty(`--monet-secondary`,`#ccc2dc`),r.style.setProperty(`--monet-on-secondary`,`#332d41`)}else{let e={r:255,g:255,b:255},t=a(s,e,.03);a(s,e,.02);let n=a(s,e,.04),i=a(s,e,.06),c=a(s,e,.08),l=a(s,e,.1);r.style.setProperty(`--monet-surface`,o(t)),r.style.setProperty(`--monet-on-surface`,`#1d1b20`),r.style.setProperty(`--monet-surface-variant`,o(a(s,{r:231,g:224,b:236},.15))),r.style.setProperty(`--monet-on-surface-variant`,`#49454f`),r.style.setProperty(`--monet-surface-container`,o(i)),r.style.setProperty(`--monet-surface-container-low`,o(n)),r.style.setProperty(`--monet-surface-container-high`,o(c)),r.style.setProperty(`--monet-surface-container-highest`,o(l)),r.style.setProperty(`--monet-background`,o(t)),r.style.setProperty(`--monet-on-background`,`#1d1b20`),r.style.setProperty(`--monet-outline`,`#79747e`),r.style.setProperty(`--monet-outline-variant`,o(a(s,{r:202,g:196,b:208},.1))),r.style.setProperty(`--monet-secondary`,o(a(s,{r:98,g:91,b:113},.2))),r.style.setProperty(`--monet-on-secondary`,`#ffffff`)}}removeAllMonetVariables(){let e=document.documentElement;e.style.removeProperty(`--monet-primary`),e.style.removeProperty(`--monet-primary-container`),e.style.removeProperty(`--monet-on-primary`),e.style.removeProperty(`--monet-on-primary-container`),e.style.removeProperty(`--monet-secondary`),e.style.removeProperty(`--monet-on-secondary`),e.style.removeProperty(`--monet-secondary-container`),e.style.removeProperty(`--monet-on-secondary-container`),e.style.removeProperty(`--monet-surface`),e.style.removeProperty(`--monet-on-surface`),e.style.removeProperty(`--monet-surface-variant`),e.style.removeProperty(`--monet-on-surface-variant`),e.style.removeProperty(`--monet-surface-container`),e.style.removeProperty(`--monet-surface-container-low`),e.style.removeProperty(`--monet-surface-container-high`),e.style.removeProperty(`--monet-surface-container-highest`),e.style.removeProperty(`--monet-background`),e.style.removeProperty(`--monet-on-background`),e.style.removeProperty(`--monet-outline`),e.style.removeProperty(`--monet-outline-variant`)}applyStoredTheme(){let n=localStorage.getItem(`theme`)||`auto`;e(n);let r=localStorage.getItem(`themeColor`)||`#6750A4`;t(r);let i=localStorage.getItem(`monetEnabled`),a=window.matchMedia(`(prefers-color-scheme: dark)`).matches,o=document.documentElement;if(i!==`false`&&n===`auto`)o.classList.add(`mdui-theme-auto`),o.classList.remove(`mdui-theme-light`,`mdui-theme-dark`),this.removeAllMonetVariables();else if(n===`auto`)o.classList.remove(`mdui-theme-auto`),o.classList.add(a?`mdui-theme-dark`:`mdui-theme-light`),this.applyAllMonetVariables(r,a);else{let e=n===`dark`;this.applyAllMonetVariables(r,e)}}setupMonetToggle(){let e=document.getElementById(`monet-toggle`);e&&e.addEventListener(`change`,e=>{let t=e.target.checked;localStorage.setItem(`monetEnabled`,String(t)),this.applyMonetSetting(t),y(v.t(`settings.monet.toast_toggled`)+(t?v.t(`common.enabled`):v.t(`common.disabled`)))})}updateMonetToggleState(){let e=localStorage.getItem(`theme`)||`auto`,t=document.getElementById(`monet-toggle`),n=localStorage.getItem(`monetEnabled`);t&&(e===`auto`?(t.disabled=!1,n===null?t.checked=!0:t.checked=n===`true`):(t.disabled=!0,t.checked=!1))}applyMonetSetting(e){let n=document.documentElement,r=localStorage.getItem(`themeColor`)||`#6750A4`,i=window.matchMedia(`(prefers-color-scheme: dark)`).matches;e?(n.classList.add(`mdui-theme-auto`),n.classList.remove(`mdui-theme-light`,`mdui-theme-dark`),this.removeAllMonetVariables(),t(r)):(n.classList.remove(`mdui-theme-auto`),n.classList.add(i?`mdui-theme-dark`:`mdui-theme-light`),this.applyAllMonetVariables(r,i)),this.ui.statusPage.updateSpeedChartColors()}showAboutDialog(){let e=document.createElement(`mdui-dialog`);e.id=`about-dialog`,e.headline=v.t(`settings.about.title`),e.innerHTML=`
            <div style="text-align: center; padding: 16px 0;">
                <img src="${D}" alt="NetProxy" style="width: 72px; height: 72px; border-radius: 16px;">
                <h2 style="margin: 16px 0 8px;">NetProxy</h2>
                <p style="color: var(--mdui-color-on-surface-variant); margin: 0;">${v.t(`settings.about.description`)}</p>
                <p style="margin-top: 16px;">
                    <mdui-chip icon="code">Xray Core</mdui-chip>
                    <mdui-chip icon="android">Magisk / KernelSU</mdui-chip>
                </p>
            </div>
            <mdui-divider></mdui-divider>
            <mdui-list>
                <mdui-list-item id="about-github">
                    <mdui-icon slot="icon" class="mdui-color-on-surface-variant" style="width: 24px; height: 24px;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </mdui-icon>
                    GitHub
                </mdui-list-item>
                <mdui-list-item id="about-telegram">
                    <mdui-icon slot="icon" class="mdui-color-on-surface-variant" style="width: 24px; height: 24px;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.696.064-1.225-.46-1.901-.903-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.477-1.635.099-.002.321.023.465.141.121.1.154.234.17.331.015.099.034.323.019.498z"/>
                        </svg>
                    </mdui-icon>
                    ${v.t(`settings.about.group`)}
                </mdui-list-item>
            </mdui-list>
            <mdui-button slot="action" variant="text">${v.t(`settings.about.close`)}</mdui-button>
        `,document.body.appendChild(e),requestAnimationFrame(()=>{e.open=!0}),e.querySelector(`#about-github`)?.addEventListener(`click`,()=>{m.openExternalUrl(`https://github.com/Fanju6/NetProxy-Magisk`)}),e.querySelector(`#about-telegram`)?.addEventListener(`click`,()=>{m.openExternalUrl(`https://t.me/NetProxy_Magisk`)}),e.querySelector(`mdui-button`).addEventListener(`click`,()=>{e.open=!1,setTimeout(()=>e.remove(),300)}),e.addEventListener(`closed`,()=>{setTimeout(()=>e.remove(),300)})}async loadModuleSettings(){try{let e=await m.getModuleSettings(),t=document.getElementById(`module-auto-start`);t&&(t.checked=e.auto_start);let n=document.getElementById(`module-oneplus-fix`);n&&(n.checked=e.oneplus_a16_fix)}catch(e){console.error(`Failed to load module settings:`,e)}}setupLanguagePage(){let e=document.getElementById(`language-back-btn`);e&&e.addEventListener(`click`,()=>{this.ui.switchPage(`settings`)});let t=document.getElementById(`language-group`);t&&t.addEventListener(`change`,e=>{let t=e.target.value;v.setLanguage(t),this.loadLanguageSettings()})}loadLanguageSettings(){let e=document.getElementById(`language-group`);e&&(e.value=v.getLanguage())}setupLogsPage(){this.setupLogsTabs(),this.setupLogsAutoRefresh(),this.setupLogsActions()}setupLogsTabs(){let e=document.getElementById(`logs-tabs`);e&&(requestAnimationFrame(()=>{let t=e.shadowRoot;if(t){let e=t.querySelector(`[part="container"]`);e&&(e.style.cssText=`display: flex; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch;`),t.querySelectorAll(`slot`).forEach(e=>{e.assignedElements().forEach(e=>{e.tagName===`MDUI-TAB`&&(e.style.cssText=`flex-shrink: 0; white-space: nowrap;`)})})}e.querySelectorAll(`mdui-tab`).forEach(e=>{e.style.cssText=`flex-shrink: 0; white-space: nowrap;`})}),e.addEventListener(`change`,e=>{this._logsSelectedTab=e.target.value,this.loadActiveLog()}))}setupLogsAutoRefresh(){let e=document.getElementById(`logs-auto-refresh`);e&&e.addEventListener(`change`,()=>{this._logsAutoRefreshEnabled=e.checked,this._logsAutoRefreshEnabled?this.startLogAutoRefresh():this.stopLogAutoRefresh()})}setupLogsActions(){document.getElementById(`export-logs-btn`)?.addEventListener(`click`,()=>this.exportLogs()),document.getElementById(`export-all-btn`)?.addEventListener(`click`,()=>this.exportAll())}startLogAutoRefresh(){this.stopLogAutoRefresh(),this._logsAutoRefreshInterval=setInterval(()=>{this.loadActiveLog()},this._logsAutoRefreshMs)}stopLogAutoRefresh(){this._logsAutoRefreshInterval&&=(clearInterval(this._logsAutoRefreshInterval),null)}loadActiveLog(){switch(this._logsSelectedTab){case`service`:this.loadServiceLog();break;case`xray`:this.loadXrayLog();break;case`tproxy`:this.loadTproxyLog();break}}async updateLogs(){await this.loadActiveLog()}async loadServiceLog(){let e=document.getElementById(`service-log`);if(e)try{let t=await m.getServiceLog();this.renderLog(e,t)}catch(t){e.innerHTML=`<span style="color: var(--mdui-color-error);">${v.t(`logs.load_failed`)}: ${t.message}</span>`}}async loadXrayLog(){let e=document.getElementById(`xray-log`);if(e)try{let t=await m.getXrayLog();this.renderLog(e,t)}catch(t){e.innerHTML=`<span style="color: var(--mdui-color-error);">${v.t(`logs.load_failed`)}: ${t.message}</span>`}}async loadTproxyLog(){let e=document.getElementById(`tproxy-log`);if(e)try{let t=await m.getTproxyLog();this.renderLog(e,t)}catch(t){e.innerHTML=`<span style="color: var(--mdui-color-error);">${v.t(`logs.load_failed`)}: ${t.message}</span>`}}renderLog(e,t){if(!t||t.trim()===``){e.innerHTML=`<span style="color: var(--mdui-color-on-surface-variant); font-style: italic;">No logs available</span>`;return}e.innerHTML=`<pre style="margin: 0; white-space: pre-wrap; word-break: break-all; font-size: 12px; line-height: 1.6;">${t.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/\n/g,`<br>`)}</pre>`,e.scrollTop=e.scrollHeight}async exportLogs(){try{let e=await m.exportLogs();e.success?y(v.t(`logs.saved_to`)+e.path):y(v.t(`logs.save_failed`))}catch(e){y(v.t(`logs.save_failed`)+`: `+e.message)}}async exportAll(){try{let e=await m.exportAll();e.success?y(v.t(`logs.saved_all_to`)+e.path):y(v.t(`logs.save_failed`))}catch(e){y(v.t(`logs.save_failed`)+`: `+e.message)}}async clearDebugLogs(){try{await m.clearDebugLogs(),y(v.t(`logs.debug_cleared`)),this.loadActiveLog()}catch(e){y(v.t(`logs.unknown_error`)+`: `+e.message)}}onLogsPageLeave(){this.stopLogAutoRefresh();let e=document.getElementById(`logs-auto-refresh`);e&&(e.checked=!1),this._logsAutoRefreshEnabled=!1}},k=class{currentPage;currentTheme;statusPage;configPage;appPage;settingsPage;constructor(){this.currentPage=`status`,this.currentTheme=localStorage.getItem(`theme`)||`auto`,this.statusPage=new S(this),this.configPage=new w(this),this.appPage=new E(this),this.settingsPage=new O(this),this.applyTheme(this.currentTheme),this.init()}init(){v.init(),document.readyState===`loading`?document.addEventListener(`DOMContentLoaded`,()=>{this.initializeMDUI()}):this.initializeMDUI(),this.setupNavigation(),this.setupFAB(),this.setupThemeToggle(),this.setupDialogs(),this.appPage.init(),this.setupAppSelector(),this.settingsPage.init(),this.statusPage.setupModeButtons(),this.switchPage(this.currentPage),setInterval(()=>{let e=document.getElementById(`status-page`);e&&e.classList.contains(`active`)&&this.statusPage.update()},9e3),setTimeout(()=>{let e=document.getElementById(`refresh-latency-btn`);e&&e.addEventListener(`click`,()=>{e.disabled=!0,e.loading=!0,setTimeout(()=>{this.statusPage.refreshLatency()},50)})},100)}initializeMDUI(){[`mdui-layout`,`mdui-top-app-bar`,`mdui-card`,`mdui-button`].forEach(e=>{customElements.get(e)||console.warn(`⚠️ Component ${e} is not defined yet`)})}setupNavigation(){let e=document.getElementById(`nav-bar`);e&&e.addEventListener(`change`,e=>{let t=e.target.value;this.switchPage(t)});let t=document.getElementById(`edit-dashboard-btn`);t&&t.addEventListener(`click`,()=>{this.statusPage.toggleEditMode()})}switchPage(e){this.currentPage===`logs`&&e!==`logs`&&this.settingsPage.onLogsPageLeave(),document.querySelectorAll(`.page`).forEach(e=>{e.classList.remove(`active`)});let t=document.getElementById(`${e}-page`);t&&t.classList.add(`active`),this.currentPage=e;let n=document.getElementById(`dashboard-fab`);n&&(n.style.display=e===`status`?`block`:`none`);let r=document.getElementById(`edit-dashboard-btn`);r&&(r.style.display=e===`status`?`block`:`none`,e!==`status`&&this.statusPage.isEditing&&this.statusPage.toggleEditMode()),setTimeout(()=>{e===`status`&&this.statusPage.update(),e===`config`&&this.configPage.update(),e===`uid`&&this.appPage.update(),e===`settings`&&this.settingsPage.update(),e===`logs`&&this.settingsPage.updateLogs()},200)}setupFAB(){let e=document.getElementById(`service-fab`);if(!e){console.warn(`FAB element not found`);return}e.addEventListener(`click`,async t=>{if(t.stopPropagation(),!e.loading){e.loading=!0;try{let t=document.getElementById(`dashboard-fab`),n=t&&t.classList.contains(`running`);e.icon=`hourglass_empty`,n?await p.stopService()||y(v.t(`status.service_stop_timeout`)):await p.startService()||y(v.t(`status.service_start_timeout`)),await this.statusPage.update()}catch(e){console.error(`FAB error:`,e),y(v.t(`common.operation_failed`)+e.message)}finally{e.loading=!1}}})}setupThemeToggle(){let e=document.getElementById(`theme-toggle`);this.applyTheme(this.currentTheme),e&&e.addEventListener(`click`,()=>{let e=[`light`,`dark`,`auto`];this.currentTheme=e[(e.indexOf(this.currentTheme)+1)%e.length],localStorage.setItem(`theme`,this.currentTheme),this.applyTheme(this.currentTheme);let t=this.currentTheme===`auto`?v.t(`settings.theme.mode_auto`):this.currentTheme===`light`?v.t(`settings.theme.mode_light`):v.t(`settings.theme.mode_dark`);y(v.t(`settings.theme.toast_mode_switched`)+t)})}applyTheme(t){let n=document.documentElement,r=localStorage.getItem(`monetEnabled`),i=window.matchMedia&&window.matchMedia(`(prefers-color-scheme: dark)`).matches;n.classList.remove(`mdui-theme-light`,`mdui-theme-dark`,`mdui-theme-auto`),t===`light`?(n.classList.add(`mdui-theme-light`),e(`light`)):t===`dark`?(n.classList.add(`mdui-theme-dark`),e(`dark`)):r===`false`?(n.classList.add(i?`mdui-theme-dark`:`mdui-theme-light`),e(i?`dark`:`light`)):(n.classList.add(`mdui-theme-auto`),e(`auto`))}setupDialogs(){let e=document.getElementById(`import-menu`);document.getElementById(`import-node-link`)?.addEventListener(`click`,()=>{e.open=!1,document.getElementById(`node-link-dialog`).open=!0}),document.getElementById(`import-full-config`)?.addEventListener(`click`,()=>{e.open=!1,this.showConfigDialog()}),document.getElementById(`node-link-cancel`)?.addEventListener(`click`,()=>{document.getElementById(`node-link-dialog`).open=!1}),document.getElementById(`node-link-save`)?.addEventListener(`click`,async()=>{await this.configPage.importNodeLink()}),document.getElementById(`import-subscription`)?.addEventListener(`click`,()=>{e.open=!1,document.getElementById(`subscription-dialog`).open=!0}),document.getElementById(`subscription-cancel`)?.addEventListener(`click`,()=>{document.getElementById(`subscription-dialog`).open=!1}),document.getElementById(`subscription-save`)?.addEventListener(`click`,async()=>{await this.configPage.saveSubscription()}),document.getElementById(`config-cancel-btn`)?.addEventListener(`click`,()=>{document.getElementById(`config-dialog`).open=!1}),document.getElementById(`uid-cancel-btn`)?.addEventListener(`click`,()=>{document.getElementById(`uid-dialog`).open=!1}),document.getElementById(`config-save-btn`)?.addEventListener(`click`,async()=>{await this.configPage.saveConfig()}),document.getElementById(`app-selector-cancel`)?.addEventListener(`click`,()=>{document.getElementById(`app-selector-dialog`).open=!1}),document.getElementById(`app-selector-search`)?.addEventListener(`input`,e=>{this.appPage.filterApps(e.target.value)});let t=document.getElementById(`check-update-btn`);t&&t.addEventListener(`click`,()=>{t.disabled=!0,t.loading=!0,setTimeout(async()=>{try{let e=await m.updateXray();e.success?(y(e.message),e.isLatest||setTimeout(()=>this.statusPage.update(),1500)):y(v.t(`common.update_failed`)+(e.error||e.message))}catch(e){y(v.t(`common.check_failed`)+e.message)}finally{t.disabled=!1,t.loading=!1}},50)})}setupAppSelector(){try{let e=document.getElementById(`add-uid-btn`);e&&e.addEventListener(`click`,()=>{this.appPage.showAppSelector()})}catch(e){console.error(`>> setupAppSelector: ERROR -`,e)}}async confirm(e){return new Promise(t=>{let n=document.getElementById(`confirm-dialog`),r=document.getElementById(`confirm-message`),i=document.getElementById(`confirm-ok-btn`),a=document.getElementById(`confirm-cancel-btn`);if(!n||!r||!i||!a){t(!1);return}r.innerHTML=e.replace(/\n/g,`<br>`);let o=i.cloneNode(!0),s=a.cloneNode(!0);i.parentNode?.replaceChild(o,i),a.parentNode?.replaceChild(s,a),o.addEventListener(`click`,()=>{n.open=!1,t(!0)}),s.addEventListener(`click`,()=>{n.open=!1,t(!1)}),n.open=!0})}showSkeleton(e,t=3,n={}){let{showIcon:r=!0}=n;e.innerHTML=``;for(let n=0;n<t;n++){let t=document.createElement(`mdui-list-item`);r?t.innerHTML=`
                    <div style="display: flex; align-items: center; gap: 12px; width: 100%; padding: 8px 0;">
                        <div class="skeleton skeleton-circle" style="width: 40px; height: 40px;"></div>
                        <div style="flex: 1;">
                            <div class="skeleton skeleton-text" style="width: 60%; height: 16px; margin-bottom: 8px;"></div>
                            <div class="skeleton skeleton-text" style="width: 40%; height: 12px;"></div>
                        </div>
                    </div>
                `:t.innerHTML=`
                    <div style="display: flex; flex-direction: column; gap: 8px; width: 100%; padding: 12px 0;">
                        <div class="skeleton skeleton-text" style="width: 50%; height: 16px;"></div>
                        <div class="skeleton skeleton-text" style="width: 70%; height: 12px;"></div>
                    </div>
                `,e.appendChild(t)}}updateAllPages(){try{this.statusPage.update()}catch(e){console.error(`Error in updateAllPages:`,e)}}async showConfigDialog(e=null){await this.configPage.showDialog(e)}};function A(){window.ksu===void 0?setTimeout(()=>{new k},500):new k}document.readyState===`loading`?document.addEventListener(`DOMContentLoaded`,A):A();